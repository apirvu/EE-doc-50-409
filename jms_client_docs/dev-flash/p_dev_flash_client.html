<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Kaazing.org - Kaazing.org Docs</title>
  <link rel="canonical" href="/documentation/5.0/windows/o_dev_dotnet/" />
  <link rel="icon" href="/img/favicon.ico">

  <link href='http://fonts.googleapis.com/css?family=Muli:300,400' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../assets/font-awesome-4.1.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="../../css/pygments.css">
  <link rel="stylesheet" href="../../css/main.css">
  <link rel="stylesheet" href="../../css/syntax.css">
  <link rel="stylesheet" href="../../css/doc.css">

  
  <!--[if lt IE 9]>
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.js"></script>
  <![endif]-->

</head>

<body>

    <!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="../../index.html"><img id="kaazing-logo-header" src="../../img/Kaazing.png" alt="Kaazing.org"></img></a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav navbar-right">
				<li><a href="http://github.com/kaazing" target="_blank">GitHub</a></li>
				<li><a href="http://developer.kaazing.com/documentation/5.0/index.html">Documentation</a></li>
				<li><a href="http://kaazing.org/download">Download</a></li>
				<li><a href="http://kaazing.org/demos">Demos</a></li>
				<li><a href="http://kaazing.org/demos/quick-start">Quick Start</a></li>
				<li><a href="http://kaazing.org/blog">Blog</a></li>
				<li class="hidden-sm"><a href="http://kaazing.org/developer-subscription">Developer Subscription</a></li>
			</ul>
		</div><!--/.nav-collapse -->
	</div>
</nav>

<div id="diagnostic">
</div>


    <div class="container page-content text-left">

  <link rel="stylesheet" href="/css/doc.css">

<div class="container page-content text-left">
<h1>Use the Kaazing Gateway Flash JMS Client Library</h1>
<p>In this procedure, you will learn how to use the Kaazing Gateway Flash JMS client library and the supported methods to build a Flash JMS client.</p>


<p><span class="note"><strong>Note</strong>: For this how-to, you can use any JMS-compliant message broker. By default, the Gateway is configured to connect to the server on tcp://localhost:61613. You can configure the connect URL in the file <span class="code_inline"><em>GATEWAY_HOME</em>/conf/gateway-config.xml</span>. See <a href="../integration-jms/o_jms_integrate.html">About Integrating Kaazing Gateway and JMS-Compliant Message Broker</a> for more information.</span></p>


<h2>Before You Begin</h2>
<p>This procedure is part of <a href="o_dev_flash.html">Checklist: How to Build Flash JMS Clients Using Kaazing Gateway</a>, that includes the following steps:</p>
<p>
    <ol>
    <li><strong>Use the Kaazing Gateway Flash JMS Client Library</strong></li>
    <li><a href="p_dev_flash_secure.html">Secure Your Flash Client</a></li>
    <li><a href="p_dev_flash_tshoot.html">Troubleshoot Flash JMS Clients</a></li>
    <li><a href="p_clientlogging_flash.html">Display Logs for the Flash JMS Client</a></li>
    </ol>
</p>

<p><span class="note"><b>Note:</b> Learn about supported browsers, operating systems, and platform versions in the <a href="../../release-notes.html">Release Notes</a>.</span></p>

<h2>To Use the Kaazing Gateway Flash JMS Client Library</h2>
<p>
<ol>
<li><p>Set up your development environment.</p>
    <ol type="a">
              <li>Download and install Kaazing Gateway as described in <a href="../about/setup-guide.html">Setting Up Kaazing Gateway</a>.</li>
              <li>In this how-to, you will use Adobe Flash Builder (formerly known as Adobe Flex Builder) to build a Flash client. You can download Adobe Flash Builder from <a href="http://opensource.adobe.com/wiki/display/flexsdk/Flex+SDK">http://opensource.adobe.com/wiki/display/flexsdk/Flex+SDK</a>.</li>
    </ol>
</li>
<li><p>Review the Flash &amp; Flex Client Demos.</p>
    <p>Before you start, take a look at the out of the box demo built with the Flash JMS Client API, which is part of the Kaazing Gateway bundle.</p>
    <p>To see this demo in action, perform the following steps:</p>
    <ol type="a">
        <li>Start the Apache ActiveMQ as described in <a href="../about/setup-guide.html">Setting Up Kaazing Gateway</a>.</li>
    <li>Start the Gateway as described in <a href="../about/setup-guide.html">Setting Up Kaazing Gateway</a>.</li>
        <li>In a browser, navigate to the out of the box demos at <span class="uri">http://localhost:8001/demo/</span>. </li>
        <li>Click <strong>Flash &amp; Flex</strong>. To run the out of the box Flash &amp; Flex demos, you must have Flash Player 10 or higher installed in your browser.</li>
    </ol>
</li>
<li><p>Build a Flex project.</p>
    <p>To build a simple Flex project, perform the following steps:</p>
    <ol type="a">
      <li>In Flash Builder, create a Flash project by choosing <strong>File &gt; New &gt; Flex Project</strong>.</li>
      <li>In the Project Name field, type a name for your project.</li>
      <li>Choose a location for the project.</li>
      <li>Under Application Type, choose <strong>Web</strong>.</li>
      <li>Under Flex SDK version, choose the Flex SDK version you wish to use. The Flash client libraries support Flex SDK 3.5 and higher.</li>
      <li>Click <strong>Next</strong>, then click <strong>Next</strong>.</li>
      <li>On the Build Paths page, ensure the Library path is active. Here, you will add the SWC library from Kaazing Gateway.</li>
      <li>Next to Component set, ensure <strong>MX only</strong> is selected.</li>
      <li>Click <strong>Add SWC...</strong>, then click <strong>Browse</strong>.
              
      <li>Navigate to <span class="code_inline"><em>GATEWAY_HOME</em>/lib/client/flash</span>, then choose <strong>com.kaazing.gateway.client.swc</strong> (WebSocket library) and <strong>com.kaazing.gateway.jms.client.swc</strong> (Stomp JMS library).</li>
      <li>Click <strong>Open</strong>, then click <strong>OK</strong>.</li>
      <li>Click <strong>Finish</strong>. The project files display in the Package Explorer. Now that you have created your project, you can start building Flash clients.</li>
    </ol>
</li>
<li><p>Use the Kaazing Gateway Flash JMS client library to build your application.</p>
    <p>A Flash client is an application or process that creates and sends and/or receives messages. To enable your Flash application to send and receive messages from your back-end message broker through the Gateway, you'll need to perform a few steps to use the JMS API with Flash to build a Flash client that you can then add to your Flash application.</p>
    <ol type="a">
        <li><p>Reference the Stomp channel package.</p>
            <p>In your MXML file, ensure you include a reference to the package containing the Stomp channel over which the messages will be sent, called <span class="code_inline">com.kaazing.gateway.jms.client.stomp</span>.</p>
        </li>
        <li><p>Set up the connection.</p>
            <p>Create a new connection with the Gateway URL.</p>
            <pre class="brush: as3; toolbar: false;">
            var env:Dictionary = new Dictionary();
            env[StompInitialContext.PROVIDER_URL] = location.text;
            initialContext = new StompInitialContext(env);</pre>
            <p>Add an <span class="code_inline">initialContextLookup</span> to use the Connection Factory.</p>
            <span class="code_inline">var connectionFactory:ConnectionFactory = initialContext.lookup(&quot;ConnectionFactory&quot;) as ConnectionFactory;<br></span><br>
            <p>Obtain the username and password to connect the client to the Gateway, then use a Connection Future to pass this connection information. In this example we use a password but the password does not have to be a text password. <span class="code_inline">createConnection()</span> can use a token of any kind. If you use text-based passwords, ensure that you have configured secure networking as described in <a href="../security/o_tls.html">Checklist: Secure Network Traffic with the Gateway</a>.</p>
            <p>
            <pre class="brush: as3; toolbar: false;">
            var username0:*= username.text.length ? username.text : null;
            var password0:*= password.text.length ? password.text : null;
            var connectionFuture:ConnectionFuture = connectionFactory.createConnection(username0,
            password0, function():void {
            try {
            connection = connectionFuture.get();
            connectedHandler(connection);
            }</pre></p>
            <p>Add an <span class="code_inline">ExceptionListenerAdapter</span>, which is used to enable you to pass in an anonymous <span class="code_inline">ExceptionListener</span>. The <span class="code_inline">ExceptionListener</span> takes an anonymous class and returns a class that can then be used. The <span class="code_inline">ExceptionListener</span> receives the equivalent of Java exceptions, which in Flash are called errors.</p>
            <p><span class="code_inline">connection.exceptionListener = new ExceptionListenerAdapter(exceptionListener);</span></p>
        </li>
        <li><p>Create a session.</p>
            <p>After you create a connection, you must create a session. The  Flash JMS Client API includes a  class called <span class="code_inline">SessionConstants</span>, which indicates whether the session should use <span class="code_inline">AUTO_ACKNOWLEDGE</span>, which tells the application that any time a message is acknowledged, not to return the message to the application. <span class="code_inline">SessionConstants</span> is also used to specify the type of connection (for example, <span class="code_inline">TRANSACTED</span>). The following is an example of how to use <span class="code_inline">SessionConstants</span>:</p>
            <p><pre class="brush: as3; toolbar: false;">
            session = connection.createSession(false, SessionConstants.AUTO_ACKNOWLEDGE);
            transactedSession = connection.createSession(true, SessionConstants.SESSION_TRANSACTED);</pre></p>
            <p class="note-para"><span class="note">
            <strong>Note</strong>: Applications built with Flex are single-threaded (not multithreaded like Java, for example) and you can debug only one application at a time. When you debug a Flash JMS client, you see only the processes and Debug view for a single thread of execution.</span></p>
        </li>
        <li><p>Add the MessageConsumer and MessageListenerAdapter.</p>
            <p>After you set up the connections and create the session, add a Message Consumer that points to the <span class="code_inline">destinationFactory</span>. The <span class="code_inline">destinationFactory</span> class is a Flash JMS Client API that says for a given name, return a destination topic or queue.</p>
            <p><span class="code_inline">MessageListenerAdapter</span> is a Flash JMS Client API class that is similar to <span class="code_inline">MessageListener</span> in the JMS API. When a consumer receives a message, this adapter calls a <span class="code_inline">MessageListener</span> and <span class="code_inline">MessageHandler</span>.</p>
<pre class="brush: as3; toolbar: false;">
private function subscribeClicked(event:Event):void {
    log("SUBSCRIBE: " + destination.text+");

    try {
        var dest:Destination = initialContext.lookup(destination.text) as Destination;
        var messageSelector:String = (selector.text != "") ? selector.text : null; 
            
        /* Multiple non-durable or queue consumers supported */ 
        var consumer:MessageConsumer = session.createConsumer(dest, messageSelector);
        consumer.messageListener = new MessageListenerAdapter(messageHandler);
                
        if (!consumers[destination.text]) {
            consumers[destination.text] = [];
        }
        consumers[destination.text].push(consumer);
    } catch (e:Error) {
        log("CAUGHT EXCEPTION");
        exceptionListener(e);
    }
}</pre>
        </li>
        <li><p>Add the MessageConstants.</p>
            <p><span class="code_inline">MessageConstant</span> is a  Flash JMS Client API class, which is the equivalent of constants in the <span class="code_inline">Message</span> class in JMS. The following is an example of <span class="code_inline">MessageConstants</span>:</p>
            <p><span class="code_inline">MessageConstants.DEFAULT_PRIORITY</span></p>
            <p class="note-para"><span class="note">
            <strong>Note</strong>: When setting up your message consumers and producers, you must use the format <span class="code_inline">&quot;/topic/&quot;</span> for regular topics. </span></p>
        </li>
        <li><p>Add client reconnect logic.</p>
            <p>You can use the <span class="code_inline">StompConnectionProperties</span> in the Flash JMS Client APIs to configure how  the client will reconnect to the server, such as how long to wait between attempting to reconnect to a server after it has disconnected. For more information, see the <a href="../apidoc/client/flash/jms/index.html">Kaazing Gateway Flash JMS Client API documentation</a>.</p>
            <p>You can also view a complex example of using the Flash JMS client library by opening the out of the box demo MXML file, called <span class="code_inline">stompjms.mxml</span>, located in <span class="code_inline"><em>GATEWAY_HOME</em>/demo/flash/src/jms/jmsclient</span>.</p>
            <p>For more information on the <a href="../about/kaazing-jms-api.html">Kaazing Gateway Flash JMS client library</a>, see <a href="../about/kaazing-jms-api.html">Kaazing Gateway JMS Client Libraries: Supported APIs</a>.</p>
        </li>
    </ol>
    </li>
</ol>
</p>

<a name="Durable"></a><h2>Durable Subscribers</h2>

<span class="note"><b>Note:</b> Currently, the Gateway does not support durable subscribers with Apache ActiveMQ. You may use durable subscribers with <a href="../integration-jms/p_jms_integrate_tibco.html">TIBCO EMS</a> or <a href="../integration-jms/p_jms_integrate_informatica.html">Informatica UM</a>. For more information, see <a href="../admin-reference/r_stomp_service.html#durables">Durable Subscribers</a>.</span><br>


<p>If your JMS client needs to receive all of the messages published on a topic, including the ones published while the subscriber is inactive because it is not being used or has lost connections (which is common when using mobile devices), create a durable <a href="../apidoc/client/flash/jms/com/kaazing/gateway/jms/client/TopicSubscriber.html">TopicSubscriber</a> using the <a href="../apidoc/client/flash/jms/com/kaazing/gateway/jms/client/Session.html#createDurableSubscriber()">Session.createDurableSubscriber()</a> method.</p> 

<p>To unsubscribe from a durable topic, use the <a href="../apidoc/client/flash/jms/com/kaazing/gateway/jms/client/Session.html#unsubscribe()">Session.unsubscribe()</a> method.</p>

<p>The JMS provider retains a separate record of each durable subscription and ensures that all messages from the topic's publishers are retained until they are acknowledged by each durable subscriber or they have expired. Whether messages have been acknowledged is tracked separately for each durable subscriber, and each durable subscriber is identified by the combination of its name and the clientID (if any) set on the Connection. Ensure your application confirms that the clientID (if used) is unique to the user or device, or, if it does not use clientID&#x27;s, ensure that the durable name is unique to the user or device.</p>

<h3>Example</h3>
<p>In the following example, a Flash app enables users to connect to a JMS broker via the Gateway and specify a durable name to create a durable subscriber. In the subscription section of the Flash app, text fields enable users to enter subscribe and send messages to a destination. Fields are included for username, destination, message selector, message, and durable name.</p>

<p>Create a variable for the durable subscriber durable name using a concatenation of the user name and durable name entered by the user. This will create a unique durable name for every user.</p>
<pre class="auto-links: false; brush: as3; toolbar: false;">
var username0:* = username.text.length ? username.text : null;
var durableName0:* = durableName.text.length ? durableName.text : null;
var UniqueDurName:* = username0 + "@" + durableName0;
</pre>

<p>The following ActionScript code performs the subscription using the durable name entered by the user.</p>
<pre class="brush: as3; toolbar: false; highlight:[24,25,27,38];">
private function subscribeClicked(event:Event):void {
    try {
        /* Look up the destination entered by the user using JNDI
        and add it to a variable */
        var dest:Destination = initialContext.lookup(destination.text) as Destination;
        // Create a variable for the message selector entered by the user
        var messageSelector:String = (selector.text != "") ? selector.text : null; 

        // If a durable name was entered by the user, do the following
        if (durableName.text != "") {
            // Ensure that the destination is a topic for durable subscribers
            if (!(dest is Topic)) {
                log("Destination must be a Topic for durable subscribers");
            }
            else {
                // Check to see if the durable name already exists
                if (topicSubscribers[UniqueDurName]) {
                    log("Subscribe on '"+UniqueDurName+"' will unsubscribe 
                        previous subscription");
                }

                /* Create the durable subscription using the destination,
                durable name, and message selector entered by the user */
                var topicSubscriber:TopicSubscriber = 
                session.createDurableSubscriber(dest as Topic, UniqueDurName, messageSelector);
                topicSubscriber.messageListener = new MessageListenerAdapter(messageHandler);
                topicSubscribers[UniqueDurName] = topicSubscriber;
            }
        }
        /* If no durable name was entered, create a MessageConsumer 
        for the specified destination, using the message selector */
        else {
            /* Multiple non-durable or queue consumers supported */ 
            var consumer:MessageConsumer = session.createConsumer(dest, messageSelector);
            consumer.messageListener = new MessageListenerAdapter(messageHandler);

            if (!consumers[destination.text]) {
                consumers[UniqueDurName] = [];
            }
            consumers[destination.text].push(consumer);
        }
    } catch (e:Error) {
        log("CAUGHT EXCEPTION");
        exceptionListener(e);
    }
}    
</pre>

<span class="note"><b>Notes:</b><br>
<ul class="arrow-2">
    <li>Sessions with durable subscribers may be created using a unique client ID or with no client ID specified. For more information, see the <a href="../admin-reference/r_stomp_service.html#stompjms">jms</a> service.</li>
    <li>A client can change an existing durable subscription by creating a durable TopicSubscriber with the same name and a new topic and/or message selector. Changing a durable subscriber is equivalent to unsubscribing (deleting) the old one and creating a new one.</li>
</ul>
</span>

<h2>Next Step</h2>
<p><a href="p_dev_flash_secure.html">Secure Your Flash Client</a></p>

<h2>Note</h2>
<ul class="arrow-2">
    <li>Clients built using Kaazing Gateway 3.x libraries will work against Kaazing Gateway 4.x. If you wish to upgrade your 3.x client to the 4.x libraries, please note that the 3.x clients used a single Stomp JMS library and 4.x clients include and use separate WebSocket and Stomp JMS libraries. Update your client library file and code references to include both the WebSocket and Stomp JMS libraries, as described in the 4.x documentation.</li>
    <li>This procedure describes the Kaazing Gateway Flash JMS client library and the supported methods to build a Flash JMS client. To find out more specific information about the supported methods or to learn which methods are not supported, refer to <a href="../about/kaazing-jms-api.html">Kaazing Gateway JMS Client Libraries: Supported APIs</a>.</li>
    <li><span class="code_inline">TemporaryTopic</span> and <span class="code_inline">TemporaryQueue</span> objects are destroyed when the client loses its connection to the Gateway, or when the JMS-compliant message broker loses its connection to the Gateway. To address this, monitor the client's exception listener to handle recovery for your application. Once the connection is re-established, recreate <span class="code_inline">TemporaryTopic</span> and <span class="code_inline">TemporaryQueue</span>. <span class="code_inline">ConnectionDroppedException</span> and <span class="code_inline">ConnectionInterruptedException</span> are delivered to the connection's exception listener via <span class="code_inline">onException</span>, indicating that messages in flight might be lost, depending on message delivery options. <span class="code_inline">ConnectionRestoredException</span> is delivered to indicate that the connection through to the JMS-compliant message broker has been re-established. <span class="code_inline">TemporaryTopic</span> and <span class="code_inline">TemporaryQueue</span> should be recreated at that time to resume operations.</li> 
</ul>



                  </section>
                </article>

            </div> <!-- #main -->
        </div> <!-- #main-container -->

    <footer>
  <div class="container">

    <div class="row text-center social-media">
      <a href="https://github.com/kaazing"><i class="fa fa-github" data-toggle="tooltip" data-placement="top" title="Github"></i></a>
      <a href="https://www.facebook.com/kaazing"><i class="fa fa-facebook" data-toggle="tooltip" data-placement="top" title="Facebook"></i></a>&nbsp;
      <a href="https://twitter.com/kaazing"><i class="fa fa-twitter" data-toggle="tooltip" data-placement="top" title="Twitter"></i></a>&nbsp;
      <a href="https://plus.google.com/+KaazingHome"><i class="fa fa-google-plus" data-toggle="tooltip" data-placement="top" title="Google Plus"></i></a>&nbsp;
      <a href="https://www.youtube.com/user/KaazingTV"><i class="fa fa-youtube" data-toggle="tooltip" data-placement="top" title="Youtube"></i></a>&nbsp;
      <a href="https://www.linkedin.com/company/kaazing-corporation"><i class="fa fa-linkedin" data-toggle="tooltip" data-placement="top" title="Linkedin"></i></a>&nbsp;
    </div>

    <div class="row copyright">
      <div class="col-xs-12 col-sm-5 text-left">
        &copy; 2007-2015 Kaazing Corporation
      </div>
      <div class="col-xs-12 col-sm-7 license">
        This website is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons BY-NC-SA</a>
      </div>
    </div>

  </div>
</footer>

<!-- start:javascript for this page -->
<script src="/js/jquery-1.11.1.min.js"></script>
<script src="/js/bootstrap.min.js"></script>









<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1771436-3', 'auto');
  ga('send', 'pageview');
  </script
  <!-- end:javascript for this page -->


</body>
</html>
