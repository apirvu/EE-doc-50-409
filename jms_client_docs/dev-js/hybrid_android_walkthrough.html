<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Kaazing.com - Kaazing WebSocket Gateway 5 Docs</title>
    <link rel="icon" href="/img/favicon.ico">

  <link href='http://fonts.googleapis.com/css?family=Muli:300,400' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../assets/font-awesome-4.1.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="../../css/pygments.css">
  <link rel="stylesheet" href="../../css/main.css">
  <link rel="stylesheet" href="../../css/syntax.css">
  <link rel="stylesheet" href="../../css/doc.css">



<!-- +++++++++++++++Syntax Highlighter Calls++++++++++++++++ -->

<!-- Include required SyntaxHighlighter JS files -->
<script type="text/javascript" src="../../resources/xregexp.js"></script>
<script type="text/javascript" src="../../resources/shCore.js"></script>


<!--Include SyntaxHighlighter brushes. To test, using the JS brush -->
<script type="text/javascript" src="../../resources/shBrushJava.js"></script>
<script type="text/javascript" src="../../resources/shBrushAS3.js"></script>
<script type="text/javascript" src="../../resources/shBrushVb.js"></script>
<script type="text/javascript" src="../../resources/shBrushJScript.js"></script>
<script type="text/javascript" src="../../resources/shBrushCss.js"></script>
<script type="text/javascript" src="../../resources/shBrushPython.js"></script>
<script type="text/javascript" src="../../resources/shBrushXml.js"></script>

<!-- Include SyntaxHighlighter core style and Kaazing theme -->
<link href="../../resources/shCore.css" rel="stylesheet" type="text/css" />
<link href="../../resources/shThemeKaazing.css" rel="stylesheet" type="text/css" />

<!-- Finally, call SyntaxHighlighter -->
<script type="text/javascript">
   SyntaxHighlighter.all()
</script>

<!-- +++++++++++++++END OF Syntax Highlighter Calls++++++++++++++++ -->
</head>

<body>

    <!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="../../index.html"><img id="kaazing-logo-header" src="../../img/Kaazing.png" alt="Kaazing.org"></img></a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav navbar-right">
				<li><a href="http://github.com/kaazing" target="_blank">GitHub</a></li>
				<li><a href="http://developer.kaazing.com/documentation/5.0/index.html">Documentation</a></li>
				<li><a href="http://kaazing.org/download">Download</a></li>
				<li><a href="http://kaazing.org/demos">Demos</a></li>
				<li><a href="http://kaazing.org/demos/quick-start">Quick Start</a></li>
				<li><a href="http://kaazing.org/blog">Blog</a></li>
				<li class="hidden-sm"><a href="http://kaazing.org/developer-subscription">Developer Subscription</a></li>
			</ul>
		</div><!--/.nav-collapse -->
	</div>
</nav>

<div id="diagnostic">
</div>


    <div class="container page-content text-left">

  <link rel="stylesheet" href="/css/doc.css">

<div class="container page-content text-left">
  <h1>Walkthrough: Deploy a JavaScript JMS App as a Hybrid Android App</h1>

  <p>In this walkthrough, you will learn how to deploy an existing JavaScript JMS web app built with the Kaazing WebSocket Gateway JavaScript JMS libraries as a hybrid app for Android. This topic walks you through the following subjects:</p>

  <ol>
  <li><a href="#Accomplish">What You Will Accomplish</a></li>
  <li><a href="#Before">Before You Begin</a></li>
  <li><a href="#Install">Install the Gateway, Android SDK, and Cordova 6.0</a></li>
  <li><a href="#Populate">Build the Hybrid Android App Using Cordova</a></li>
  <li><a href="#Apache">Configure and Run the Gateway and Apache ActiveMQ</a></li>
  <li><a href="#Build">Test the Hybrid Android App</a></li>
  <li><a href="#summary">Summary</a></li>
  </ol>

  <span class="note"><b>Notes:</b>
   <ul class="arrow-2">
     <li>A hybrid Android app is a hybrid of a browser-based application and a native Android app. A native Android app is built using the Android SDK. A hybrid Android app is built using HTML, CSS, and JavaScript like a typical browser-based application, and then packaged in a framework that allows it to be converted into an app that runs on Android devices much like a native app. Hybrid Android apps enable web developers to leverage their web experience to create apps for Android. For information on native Android development, see <a href="http://developer.android.com/develop/index.html">Android Develop</a>.</li>
     <li>A hybrid Android app is also different from a browser-based application that is intended for viewing in a browser on Android, but not downloaded through the Android app store. If you have an existing Kaazing WebSocket Gateway JavaScript JMS browser-based application, you can use it to create a hybrid Android app or you can modify its web content to make it compatible with browsers on Android.</li>
   </ul>
  </span>

  <h2><a name="Accomplish"></a>What You Will Accomplish</h2>
  <p>At the end of this walkthrough, a JavaScript JMS demo created using the Kaazing WebSocket Gateway JavaScript JMS libraries runs as a hybrid Android app on Android, connects to the Apache ActiveMQ broker via the Gateway, and sends and receives JMS messages using a native or emulated WebSocket connection. Users can run the hybrid Android app on any Android device and connect via the Gateway to the Apache ActiveMQ broker.</p>
  <p>This walkthrough uses the JavaScript JMS demo that ships with the Gateway as the example app, but the steps outlined in this walkthrough are the same for other JavaScript JMS client applications built with the Gateway.</p>


  <p><span class="note"><strong>Note</strong>: For this walkthrough, you can use any JMS-compliant message broker. By default, the Gateway is configured to connect to the server on tcp://localhost:61613. You can configure the connect URL in the file <span class="code_inline"><em>GATEWAY_HOME</em>/conf/gateway-config.xml</span>. See <a href="../integration-jms/o_jms_integrate.html">About Integrating Kaazing WebSocket Gateway and JMS-Compliant Message Brokers</a> for more information.</span></p>


  <h2><a name="Before"></a>Before You Begin</h2>
  <p>Before starting this walkthrough you need the following:</p>
  <ul class="arrow-2">
  <li>Kaazing WebSocket Gateway - JMS Edition. See <a href="../about/setup-guide.html">Setting Up Kaazing WebSocket Gateway</a>.</li>
  <li><a href="http://developer.android.com/sdk/index.html">Android Studio and SDK</a></li>
  <li><a href="https://cordova.apache.org/docs/en/latest/guide/cli/index.html#installing-the-cordova-cli">Apache Cordova 6.0 and its Command-Line Interface (CLI)</a></li>
  </ul>

  <p>Learn about supported browsers, operating systems, and platform versions in <a href="../release-notes.html">Release Notes</a>.</p>

  <p><strong>Note:</strong> Steps for installing and configuring Android Studio, Android SDK, and Cordova 6.0 are included in this walkthrough.</p>

  <h2><a name="Install"></a>Install the Gateway, Android Studio, Android SDK, and Cordova 6.0</h2>
  <p>The following steps take you through the installation of the software required for deploying a hybrid Android app. If you have already have this software installed, you can simply note the locations of the installed software for later use.</p>
  <ol>

  <li>Install the Gateway as described in <a href="../about/setup-guide.html">Setting Up Kaazing WebSocket Gateway</a>.</li>

  <li>Download and install Android Studio from <a href="http://developer.android.com/sdk/installing/index.html?pkg=studio">http://developer.android.com/sdk/installing/index.html?pkg=studio</a>.</li>

  <li>Launch Android Studio.</li>

  <li>In <strong>Welcome to Android Studio</strong>, click <strong>Configure</strong>, and then click <strong>SDK Manager</strong>.</li>

  <li>Select the <strong>Android 2.2</strong> and the <strong>Android 4.1</strong> packages and then click <strong>Install packages</strong>.</li>

  <li>Download and install Cordova 6.0 as described in <a href="https://cordova.apache.org/docs/en/latest/guide/cli/index.html#installing-the-cordova-cli">Installing the Cordova CLI</a> from Cordova.</li>

  </ol>

  <h2><a name="Populate"></a>Build the Hybrid Android App Using Cordova</h2>

  <p>The following steps will create the project directory for the hybrid Android app, and populate the directory with the web app files and JavaScript JMS library files required to communicate with the Gateway.</p>

  <p><strong>Note:</strong> The general steps for creating an Android app using Cordova are documented in the Apache Cordova Documentation, <a href="https://cordova.apache.org/docs/en/latest/guide/cli/index.html#create-the-app">Create the App</a>.</p>

  <ol>
    <li>Open a Terminal at the folder where you want to save the app.</li>
    <li><p>To create the app and populate it with the JavaScript demo, enter the following:</p>
      <p><code>cordova create myAndroidApp com.example.myapp myAndroidApp --template <em>GATEWAY_HOME</em>/demo/cordova/www</code></p>
      <p>The <code><em>GATEWAY_HOME</em>/demo/cordova/www</code> points to the JavaScript demo files included with the Gateway.</p>
    </li>
    <li>In the <strong>myAndroidApp</strong> folder created by Cordova, open the HTML file that contains the HTML GUI and JavaScript code of your app. It is located here: <strong>myAndroidApp/www/index.html</strong>.</li>
    <li><p>Replace the contents of <strong>index.html</strong> with the following:</p>
  <pre class="auto-links: false; brush: xml; toolbar: false;">
  &lt;!DOCTYPE html&gt;
  &lt;html class=&quot;no-js&quot;&gt;
  &lt;head&gt;

    &lt;link rel=&quot;stylesheet&quot; href=&quot;resources/css/normalize.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;resources/css/dev.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;resources/css/demo.css&quot;&gt;

    &lt;style&gt;

      body {
        margin: 2px;
        margin-top: 0;
        background-color: whitesmoke;
      }

      h1 {
        font-size: 24px;
        margin-top: 0;
      }

      div.setting {
        margin-top: 5px;
      }
      div.setting:first-of-type {
        margin-top: 0;
      }
      div.setting label {
        width: 80px;
      }
      div.setting input {
        width: 180px;
        margin-bottom: 0;
      }
      div.setting button {
        width: 85px;
      }

      #console {
        position: relative;
        float: left;
        overflow-y: scroll;
        width: 100%;
        height: 200px;
        border: solid 1px #dddddd;
        background-color: white; }

      #console pre {
        font-family: monospace; }

      #console &gt; div {
        border-bottom: dashed 1px #dddddd;
        padding-top: 5px;
        padding-bottom: 5px; }

      #console div {
        font-family: monospace;
        padding-left: 5px;
        font-size: 15px;
        line-height: 18px; }

      #console &gt; div:nth-child(even) {
        background-color: #fafafa; }

      #console div div {
        line-height: 15px; }

      #console .error {
        color: red; }

      #console &gt; div &gt; div {
        display: block;
        margin-left: 15px;
        font-size: smaller; }

      #console .sendMessage {
        color: #336633; }

      #console .sendMessage .destination {
        color: #577557; }

      #console .sendMessage .properties {
        color: #45ad45; }

      #console .sendMessage .headers {
        color: #8aad45; }

      #console.hidden .headers {
        /*    display: none; */
        background-color: red; }

      #console .receiveMessage {
        color: #0000ff; }

      #console .receiveMessage .destination {
        color: #6666ff; }

      #console .receiveMessage .properties {
        color: #4791ff; }

      #console .receiveMessage .headers {
        color: #7193eb; }

      #console .txSendMessage {
        color: #606; }

      #console .txSendMessage &gt; div {
        color: #9e4d9e; }

      #subscriptions {
        border: 0;
        font-size: smaller;
        width: 100%;
        margin: 0;
      }

      #subscriptions th, #subscriptions td {
        background-color: whitesmoke;
        border: 0;
        text-align: left;
        padding-left: 5px;
        padding-right: 5px;
        line-height: 150%;
  /*      padding-top: 3px;
        padding-bottom: 3px;
  */    }

      #subscriptions th {
        padding-top: 2px;
        padding-bottom: 2px;
        line-height: 15px;
        font-size: 14px;
      }

      #subscriptions &gt; thead, #subscriptions &gt; tbody &gt; tr:nth-child(even) {
        background-color: #fbfbfb; }

      #subscriptions th.destination, #subscriptions td.destination {
        white-space: nowrap;
  /*      min-width: 125px; */
        /*line-height: 15px;*/
      }

      #subscriptions th.unsubscribe, #subscriptions td.unsubscribe {
        width: 100%; }

      #subscriptions button {
        font-size: smaller; }

      #console_div label {
        width: auto;
        margin-left: 5px; }

      #middle .subscriptionTag {
        color: #aaaaaa; }

      div.section-heading {
        font-weight: bold;
      }

      div.section-heading-left {
        float: left;
      }
      div.toggle {
        float: right;
      }

      input[type=checkbox] {
        width: 20px;
      }

      label[for=toggleJmsHeadersCb] {
        width: 140px;
        float: none;
        font-weight: normal;
      }

      button#clear {
        float: right;
      }

      img#logo {
        width: 166px;
        margin-left: 3px;
      }

    &lt;/style&gt;

    &lt;script src=&quot;resources/js/jquery-1.9.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;resources/js/modernizr.js&quot;&gt;&lt;/script&gt;

  &lt;/head&gt;
  &lt;body&gt;

  &lt;!--  Kaazing scripts --&gt;
  &lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;WebSocket.js&quot;&gt;&lt;/script&gt;
  &lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;JmsClient.js&quot;&gt;&lt;/script&gt;

  &lt;script type=&quot;text/javascript&quot;&gt;

  var connection;
  var session;

  /* UI Elements */
  var logConsole, url, connectBut;
  var destination, message, subscribe, send;
  var rollback, clear;
  var receivedMessageCount, receivedMessageCounter = 0;
  var subscriptionsTable;
  var destinationCounter = 1;
  var toggleJmsHeadersCb;
  var logoHeight;

  function clearLog() {
    while (logConsole.childNodes.length &gt; 0) {
      logConsole.removeChild(logConsole.lastChild);
    }
  }

  // Log a string message
  function log(message) {
    var div = document.createElement(&quot;div&quot;);
    div.className = &quot;logMessage&quot;
    div.innerHTML = message;
    logDiv(div);
  }

  function logDiv(div) {
    logConsole.appendChild(div);
    toggleJmsHeaders(); // Hide the headers if that&#x27;s what the user specified
    // Make sure the last line is visible.
    logConsole.scrollTop = logConsole.scrollHeight;
    while (logConsole.childNodes.length &gt; 20) {
      // Delete two rows to preserved the alternate background colors.
      logConsole.removeChild(logConsole.firstChild);
      logConsole.removeChild(logConsole.firstChild);
    }
  }

  function updateConnectionButtons(connected) {
    if (connected) {
      connectBut.innerHTML = &quot;Disconnect&quot;;
    } else {
      connectBut.innerHTML = &quot;Connect&quot;;
    }
    subscribe.disabled = !connected;
    send.disabled = !connected;
  }

  function createDestination(name, session) {
    if (name.indexOf(&quot;/topic/&quot;) == 0) {
      return session.createTopic(name);
    }
    else if (name.indexOf(&quot;/queue/&quot;) == 0) {
      return session.createQueue(name);
    }
    else {
      throw new Error(&quot;Destination must start with /topic/ or /queue/&quot;);
    }
  }

  function handleConnectBut() {
    if (connectBut.innerHTML == &quot;Connect&quot;) {
      doConnect();
    } else {
      doDisconnect();
    }
  }

  function doConnect() {
    log(&quot;CONNECT: &quot; + url.value);

    var jmsConnectionFactory = new JmsConnectionFactory(url.value);

    //setup challenge handler
    setupSSO(jmsConnectionFactory.getWebSocketFactory());
    try {
      var connectionFuture =
      jmsConnectionFactory.createConnection(null, null, function () {
        if (!connectionFuture.exception) {
          try {
            connection = connectionFuture.getValue();
            connection.setExceptionListener(handleException);

            log(&quot;CONNECTED&quot;);

            session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
            transactedSession = connection.createSession(true, Session.AUTO_ACKNOWLEDGE);

            connection.start(function () {
              updateConnectionButtons(true);
            });
          }
          catch (e) {
            handleException(e);
          }
        }
        else {
          handleException(connectionFuture.exception);
        }
      });
    }
    catch (e) {
      handleException(e);
    }
  }

  function handleException(e) {
    log(&quot;&lt;span class=&#x27;error&#x27;&gt;EXCEPTION: &quot; + e+&quot;&lt;/span&gt;&quot;);

    if (e.type == &quot;ConnectionDisconnectedException&quot;) {
      updateConnectionButtons(false);
    }
  }

  function doDisconnect() {
    // Clear any subscriptions.
    if (document.getElementsByClassName) {
      var subscriptions = document.getElementsByClassName(&quot;unsubscribeButton&quot;);
      while (subscriptions[0]) {
        subscriptions[0].click();
      }
    } else {
      // The IE way.
      var unsubscribeButtons = subscriptionsTable.getElementsByTagName(&quot;button&quot;);
      while (unsubscribeButtons.length &gt; 0) {
        var b = unsubscribeButtons[0];
        if (b.className == &quot;unsubscribeButton&quot;) {
          b.click();
        }
      }
    }

    log(&quot;CLOSE&quot;);
    try {
      connection.close(function () {
        log(&quot;CONNECTION CLOSED&quot;);
        updateConnectionButtons(false);
      });
    }
    catch (e) {
      handleException(e);
    }
  }

  function handleSubscribe() {
    var name = destination.value;

    var destinationId = destinationCounter++;

    log(&quot;SUBSCRIBE: &quot; + name + &quot; &lt;span class=\&quot;subscriptionTag\&quot;&gt;[#&quot;+destinationId+&quot;]&lt;/span&gt;&quot;);

    var dest = createDestination(name, session);

    var consumer;

    consumer = session.createConsumer(dest);

    consumer.setMessageListener(function(message) {
      handleMessage(name, destinationId, message);
    });

    // Add a row to the subscriptions table.
    //

    var tBody = subscriptionsTable.tBodies[0];

    var rowCount = tBody.rows.length;
    var row = tBody.insertRow(rowCount);

    var destinationCell = row.insertCell(0);
    destinationCell.className = &quot;destination&quot;;
    destinationCell.appendChild(document.createTextNode(name+&quot; &quot;));
    var destNode = document.createElement(&quot;span&quot;);
    destNode.className = &quot;subscriptionTag&quot;;
    destNode.innerHTML = &quot;[#&quot;+destinationId+&quot;]&quot;;
    destinationCell.appendChild(destNode);

    var unsubscribeCell = row.insertCell(1);
    unsubscribeCell.className = &quot;unsubscribe&quot;;
    var unsubscribeButton = document.createElement(&quot;button&quot;);
    unsubscribeButton.className = &quot;unsubscribeButton&quot;;
    unsubscribeButton.innerHTML = &quot;Unsubscribe&quot;;
    unsubscribeButton.addEventListener(&#x27;click&#x27;, function(event) {
      var targ;
      if (event.target) {
        targ = event.target;
      } else {
        targ=event.srcElement; // The wonders of IE
      }
      log(&quot;UNSUBSCRIBE: &quot; + name + &quot; &lt;span class=\&quot;subscriptionTag\&quot;&gt;[#&quot;+destinationId+&quot;]&lt;/span&gt;&quot;);
      if (consumer) {
        consumer.close(null);
      }
      var rowIndex = targ.parentElement.parentElement.rowIndex
      subscriptionsTable.deleteRow(rowIndex);
        setLogPaneHeight();
    }, false);
    unsubscribeCell.appendChild(unsubscribeButton);

    setLogPaneHeight();
  }

  function handleMessage(destination, destinationId, message) {
    var content = &quot;&quot;;

    if (message instanceof TextMessage) {
      content = &quot;RECEIVED TextMessage: &quot; + message.getText();
    }
    else if (message instanceof BytesMessage) {
      var body = [];
      message.readBytes(body);
      content = &quot;RECEIVED BytesMessage: &quot; + body;
    }
    else if (message instanceof MapMessage) {
      var keys = message.getMapNames();
      content = &quot;RECEIVED MapMessage: &lt;br/&gt;&quot;;

      for (var i=0; i&lt;keys.length; i++) {
        var key = keys[i];
        var value = message.getObject(key);
        var type;
        if (value == null) {
          type = &quot;&quot;;
        }
        else if (value instanceof String) {
          type = &quot;String&quot;;
        }
        else if (value instanceof Number) {
          type = &quot;Number&quot;;
        }
        else if (value instanceof Boolean) {
          type = &quot;Boolean&quot;;
        }
        else if (value instanceof Array) {
          type = &quot;Array&quot;;
        }
        content += key + &quot;: &quot; + value;
        if(type != &quot;&quot;) {
          content += &quot; (&quot; + type + &quot;)&quot;
        }
        content += &quot;&lt;br /&gt;&quot;;
      }
    }
    else {
      content = &quot;RECEIVED UNKNOWN MESSAGE&quot;;
    }

    var div = document.createElement(&quot;div&quot;);
    div.className = &quot;logMessage receiveMessage&quot;
    div.innerHTML = content;

    div.appendChild(buildDestinationDiv(&quot;Destination&quot;, destination));

    div.appendChild(buildPropertiesDiv(message));

    div.appendChild(buildJMSHeadersDiv(message, true));

    logDiv(div);

    receivedMessageCount.innerHTML = ++receivedMessageCounter;
  }

  var logMessageSend = function(classname, prefix, destination, messageStr, message) {
    var div = document.createElement(&quot;div&quot;);
    div.className = &quot;logMessage &quot;+classname
    div.innerHTML = prefix + messageStr;

    div.appendChild(buildPropertiesDiv(message));

    div.appendChild(buildJMSHeadersDiv(message, false));

    div.appendChild(buildDestinationDiv(&quot;Destination&quot;, destination));

    logDiv(div);
  }

  var buildDestinationDiv = function(label, destName, destId) {
    var destinationDiv = document.createElement(&quot;div&quot;);
    destinationDiv.className = &quot;destination&quot;;
    var destIdStr = &quot;&quot;;
    if (destId != undefined) {
      destIdStr = &quot; [#&quot;+destId+&quot;]&quot;;
    }
    destinationDiv.innerHTML += label + &quot;: &quot; + destName+destIdStr;
    return destinationDiv;
  }

  var buildPropertiesDiv = function(message) {
    var propsDiv = document.createElement(&quot;div&quot;);
    propsDiv.className = &quot;properties&quot;;
    var props = message.getPropertyNames();
    while (props.hasMoreElements()) {
      var propName = props.nextElement();
      var propValue = message.getStringProperty(propName);
      propsDiv.innerHTML += &quot;Property: &quot;+propName+&quot;=&quot;+propValue+&quot;&lt;br&gt;&quot;;
    }
    return propsDiv;
  }

  var buildJMSHeadersDiv = function(message, receive) {
    var headersDiv = document.createElement(&quot;div&quot;);
    headersDiv.className = &quot;headers&quot;;
    var deliveryModeStr;
    switch (message.getJMSDeliveryMode()) {
    case DeliveryMode.NON_PERSISTENT:
      deliveryModeStr = &quot;NON_PERSISTENT&quot;;
      break;
    case DeliveryMode.PERSISTENT:
      deliveryModeStr = &quot;PERSISTENT&quot;;
      break;
    default:
      deliveryModeStr = &quot;UNKNOWN&quot;;
    }

    var jmsDestination = message.getJMSDestination();
    var destinationName = (jmsDestination instanceof Queue) ? jmsDestination.getQueueName()
    : jmsDestination.getTopicName();
    headersDiv.innerHTML += &quot;JMSDestination: &quot; + destinationName +&quot;&lt;br&gt;&quot;;

    if (receive) {
      headersDiv.innerHTML += &quot;JMSRedelivered: &quot; + message.getJMSRedelivered()+&quot;&lt;br&gt;&quot;;
    }

    headersDiv.innerHTML += &quot;JMSDeliveryMode: &quot;+message.getJMSDeliveryMode()+&quot; (&quot;+deliveryModeStr+&quot;)&lt;br&gt;&quot;;
    headersDiv.innerHTML += &quot;JMSPriority: &quot;+message.getJMSPriority()+&quot;&lt;br&gt;&quot;;
    headersDiv.innerHTML += &quot;JMSMessageID: &quot;+message.getJMSMessageID()+&quot;&lt;br&gt;&quot;;
    headersDiv.innerHTML += &quot;JMSTimestamp: &quot;+message.getJMSTimestamp()+&quot;&lt;br&gt;&quot;;
    headersDiv.innerHTML += &quot;JMSCorrelationID: &quot;+message.getJMSCorrelationID()+&quot;&lt;br&gt;&quot;;
    headersDiv.innerHTML += &quot;JMSType: &quot;+message.getJMSType()+&quot;&lt;br&gt;&quot;;
    headersDiv.innerHTML += &quot;JMSReplyTo: &quot;+message.getJMSReplyTo()+&quot;&lt;br&gt;&qquot;;
    return headersDiv;
  }

  var addProperties = function(message) {
    var i = 1;
    var propName;
    while (propName = document.getElementById(&quot;propName&quot;+i)) {
      if (propName.value.length &gt; 0) {
        var propValue = document.getElementById(&quot;propValue&quot;+i);
        message.setStringProperty(propName.value, propValue.value);
      }
      i++;
    }
  }

  function handleSend() {
    var name = destination.value;
    var dest = createDestination(name, session);
    var producer = session.createProducer(dest);

    var textMsg = session.createTextMessage(message.value);

    addProperties(textMsg);

    try {
      var future = producer.send(textMsg, function(){
        if (future.exception) {
          handleException(future.exception);
        }
      });
    } catch (e) {
      handleException(e);
    }

    logMessageSend(&quot;sendMessage&quot;, &quot;SEND TextMessage: &quot;, destination.value, message.value, textMsg);

    producer.close();
  }

  var toggleJmsHeaders = function(event) {
    $(&#x27;div.headers&#x27;).toggleClass(&#x27;hidden&#x27;, !toggleJmsHeadersCb.checked);
  }

  $( document ).ready(function() {

    // Initialize UI elements
    url = document.getElementById(&quot;url&quot;);

    connectBut = document.getElementById(&quot;connectBut&quot;);

    logConsole = document.getElementById(&quot;console&quot;)
    receivedMessageCount = document.getElementById(&quot;receivedMessageCount&quot;);
    toggleJmsHeadersCb = document.getElementById(&quot;toggleJmsHeadersCb&quot;);

    destination = document.getElementById(&quot;destination&quot;);
    message = document.getElementById(&quot;message&quot;);
    subscribe = document.getElementById(&quot;subscribe&quot;);
    send = document.getElementById(&quot;send&quot;);

    clear = document.getElementById(&quot;clear&quot;);

    subscriptionsTable = document.getElementById(&quot;subscriptions&quot;);

    // default the location
    url.value = &quot;ws://10.0.2.2:8888/jms&quot;;

    updateConnectionButtons(false);

    connectBut.onclick = handleConnectBut;
    subscribe.onclick = handleSubscribe;
    send.onclick = handleSend;

    clear.onclick = clearLog;
    toggleJmsHeadersCb.onclick = toggleJmsHeaders;

    // initialize the disabled states
    connectBut.disabled = null;

    logoHeight = $(&quot;#logo&quot;).height();

    setLogPaneHeight();


  });

    // Grow the log pane to fit to the bottom of the window, if there is
    // space available.
  function setLogPaneHeight() {
    var windowHeight = $(window).height();
    var console = $(&quot;#console&quot;);
    if (console.position().top &lt; windowHeight - logoHeight) {
      console.css(&quot;height&quot;, windowHeight - console.position().top - (console.outerHeight() - console.height()) - logoHeight);
    }
  }

  function setupSSO(webSocketFactory) {
    /* Respond to authentication challenges with popup login dialog */
    var basicHandler = new BasicChallengeHandler();
    basicHandler.loginHandler = function(callback) {
      popupLoginDialog(callback);
    }
    webSocketFactory.setChallengeHandler(basicHandler);
  }


  function popupLoginDialog(callback) {
    //popup dialog to get credentials
    var popup = document.getElementById(&quot;sso_logindiv&quot;);
    popup.style.display = &quot;block&quot;;
    var login = document.getElementById(&quot;sso_login&quot;);
    var cancel = document.getElementById(&quot;sso_cancel&quot;);

    //&quot;OK&quot; button was clicked, invoke callback function with credential to login
    login.onclick = function() {
      var username = document.getElementById(&quot;sso_username&quot;);
      var password = document.getElementById(&quot;sso_password&quot;);
      var credentials = new PasswordAuthentication(username.value, password.value);
      //clear user input
      username.value = &quot;&quot;;
      password.value = &quot;&quot;;
      //hide popup
      popup.style.display = &quot;none&quot;;
      callback(credentials);
    }
    //&quot;Cancel&quot; button has been clicked, invoke callback function with null argument to cancel login
    cancel.onclick = function() {
      var username = document.getElementById(&quot;sso_username&quot;);
      var password = document.getElementById(&quot;sso_password&quot;);
      //clear user input
      username.value = &quot;&quot;;
      password.value = &quot;&quot;;
      //hide popup
      popup.style.display = &quot;none&quot;;
      callback(null);
    }
  }

  &lt;/script&gt;

    &lt;h1&gt;Cordova JMS Messaging Demo&lt;/h1&gt;

    &lt;div class=&quot;setting&quot;&gt;
    &lt;label for=&quot;url&quot;&gt;Location&lt;/label&gt;
    &lt;input id=&quot;url&quot; /&gt;
    &lt;button id=&quot;connectBut&quot;&gt;Connect&lt;/button&gt;
    &lt;!-- Login dialog for testing authentication --&gt;
    &lt;div id=&quot;sso_logindiv&quot; style=&quot;margin-left: 2px; position: absolute; border: 1px solid black; border-radius:10px; display: none; height: 190px; width: 318px; background-color:#d0e7fd; z-index: 999;&quot;&gt;
      &lt;div style=&quot;margin-left: 20px; height: 35px; margin-top: 20px; font-weight: bold;&quot;&gt;Login&lt;/div&gt;
      &lt;div style=&quot;height: 124px; width: 296px; border: 1px solid black; border-radius:10px; background-color:white; margin-left: 10px;&quot;&gt;
        &lt;div style=&quot;margin-left:10px; margin-top: 10px;&quot;&gt;
          &lt;span style=&quot;width: 60px; font-size:11pt;&quot;&gt;Username:&lt;/span&gt;&lt;input id=&quot;sso_username&quot; size=&quot;12&quot; style=&quot;width: 180px&quot; value=&quot;&quot; /&gt;
        &lt;/div&gt;
        &lt;div style=&quot;margin-left:10px&quot;&gt;
          &lt;span style=&quot;width: 60px;  font-size:11pt;&quot;&gt;Password:&lt;/span&gt;&lt;input id=&quot;sso_password&quot; type=&quot;password&quot; size=&quot;12&quot; style=&quot;width: 180px&quot; value=&quot;&quot; /&gt;
        &lt;/div&gt;
        &lt;div style=&quot;margin-left:45px&quot;&gt;
          &lt;button id=&quot;sso_login&quot; style=&quot;margin-left:25px; width: 60px;&quot;&gt;OK&lt;/button&gt;
          &lt;button id=&quot;sso_cancel&quot;  style=&quot;margin-left:25px; width: 60px;&quot;&gt;Cancel&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;!-- Login dialog for testing authentication --&gt;
    &lt;/div&gt;

    &lt;div class=&quot;setting&quot;&gt;
    &lt;label for=&quot;destination&quot;&gt;Destination&lt;/label&gt;
    &lt;input id=&quot;destination&quot; value=&quot;/topic/destination&quot;&gt;
    &lt;button id=&quot;subscribe&quot;&gt;Subscribe&lt;/button&gt;
    &lt;/div&gt;

    &lt;div class=&quot;setting&quot;&gt;
    &lt;label for=&quot;message&quot;&gt;Message&lt;/label&gt;
    &lt;input id=&quot;message&quot; value=&quot;Hello, message&quot;&gt;
    &lt;button id=&quot;send&quot;&gt;Send&lt;/button&gt;
    &lt;/div&gt;

    &lt;hr /&gt;

    &lt;div class=&quot;section-heading&quot;&gt;Subscriptions&lt;/div&gt;
    &lt;table id=&quot;subscriptions&quot;&gt;

      &lt;tbody&gt;

      &lt;/tbody&gt;

    &lt;/table&gt;

    &lt;hr /&gt;

    &lt;div class=&quot;section-heading section-heading-left&quot;&gt;Log&lt;/div&gt;
    &lt;div class=&quot;toggle&quot;&gt;
    &lt;input type=&quot;checkbox&quot; id=&quot;toggleJmsHeadersCb&quot; class=&quot;cb&quot;&gt;
    &lt;label for=&quot;toggleJmsHeadersCb&quot;&gt;Show JMS headers&lt;/label&gt;
    &lt;/div&gt;
    &lt;div style=&quot;clear: both;&quot;&gt;&lt;/div&gt;

    Messages received : &lt;span id=&quot;receivedMessageCount&quot;&gt;0&lt;/span&gt;
    &lt;button id=&quot;clear&quot;&gt;Clear Log&lt;/button&gt;
    &lt;div style=&quot;clear: both;&quot;&gt;&lt;/div&gt;

    &lt;div id=&quot;console&quot;&gt;&lt;/div&gt;
    &lt;div style=&quot;clear: both;&quot;&gt;&lt;/div&gt;

    &lt;img id=&quot;logo&quot; src=&quot;resources/images/nav-logo-kaazing.png&quot; /&gt;

  &lt;/body&gt;
  &lt;/html&gt;
  </pre>

  <p><strong>Note:</strong> This walkthrough uses the out of the box JavaScript JMS demo as an example web app, but when you create your own JavaScript JMS app, you can create it in your favorite IDE and then copy it to this <strong>www</strong> directory. You must name the HTML file for your app <strong>index.html</strong> and you must ensure that links in <strong>index.html</strong> point to the JavaScript WebSocket library (by default, <span class="code_inline"><em>GATEWAY_HOME</em>/lib/client/javascript</span>) and the JavaScript JMS library (by default, <span class="code_inline"><em>GATEWAY_HOME</em>/lib/client/javascript/jms</span>), for example:</p>
  <pre class="brush: xml; toolbar: false;">
  &lt;script src=&quot;WebSocket.js&quot; type=&quot;text/javascript&quot; language=&quot;javascript&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;JmsClient.js&quot; type=&quot;text/javascript&quot; language=&quot;javascript&quot;&gt;&lt;/script&gt;
  </pre>
    </li>
    <li>Save <strong>index.html</strong>.</li>
    <li>In Terminal, navigate to the folder for your new app (<code>cd myAndroidApp</code>).</li>
    <li>To specify the target platform as Android, enter the following command: <code>cordova platform add android</code>. Note: To see a list of the current platforms available, enter: <code>cordova platforms ls</code>.</li>
    <li><p>To build the project, enter the following command: <code>cordova build android</code>. The build process might take some time. When it is finsihed, Cordova generates the platform-specific project within the project's <strong>platforms</strong> subdirectory that you can open with Android Studio (for example, <strong>myAndroidApp/platforms/android</strong>).</p>
    <p>On Mac or Linux, if you receive the error <code>Error: Android SDK not found</code> then open your <strong>.bash_profile</strong> file and enter the following (replace <em>JohnSmith</em> with your user name):</p>

    <p><code>export ANDROID_HOME=/Users/<em>JohnSmith</em>/Library/Android/sdk<br>export PATH=$ANDROID_HOME/platform-tools:$PATH<br>export PATH=$ANDROID_HOME/tools:$PATH<br></code></p>

    <p>For more info, <a href="https://cordova.apache.org/docs/en/dev/guide/platforms/android/">https://cordova.apache.org/docs/en/dev/guide/platforms/android/</a>.</p>
    </li>
  </ol>


  <h2><a name="Apache"></a>Configure and Run the Gateway and Apache ActiveMQ</h2>
  <p>Now that you've set up the project for your Android app, you can start Apache ActiveMQ and the Gateway. The following steps start the Apache ActiveMQ service that is included with the Gateway, configure the Gateway to work with the hybrid Android app, and then run the Gateway.</p>
  <ol>
  <li>Start Apache ActiveMQ. For steps on starting Apache ActiveMQ, see the setup information for Apache ActiveMQ. Typically, open a Terminal in <code><em>ACTIVEMQ_HOME</em>/bin</code> and enter: <code>./activemq start</code>.</li>
  <li>Open the <span class="code_inline"><em>GATEWAY_HOME</em>/conf/gateway-config.xml</span> file in a text editor. You need to modify this file to use the Android Emulator loopback IP address (10.0.2.2) and you need to change the cross site constraint to allow any origin in order to run the app locally. 10.0.2.2 is the special alias to your host loopback interface (127.0.0.1 on your development machine). For more information about Android Emulator networking, see <a href="http://developer.android.com/tools/devices/emulator.html#emulatornetworking">Emulator Networking</a> from Android.</li>
  <li><p>Modify the <code>jms</code> service to use the Android loopback IP address and the cross site constraint to allow any origin:</p>
  <pre class="auto-links: false; brush: xml; toolbar: false;highlight:[4,16,17,18,23];">
  &lt;service&gt;
    &lt;name&gt;JMS Service&lt;/name&gt;
    &lt;description&gt;JMS Service&lt;/description&gt;
    &lt;accept&gt;ws://10.0.2.2:8888/jms&lt;/accept&gt;

    &lt;type&gt;jms&lt;/type&gt;

    &lt;properties&gt;
      &lt;connection.factory.name&gt;ConnectionFactory&lt;/connection.factory.name&gt;
      &lt;context.lookup.topic.format&gt;dynamicTopics/%s&lt;/context.lookup.topic.format&gt;
      &lt;context.lookup.queue.format&gt;dynamicQueues/%s&lt;/context.lookup.queue.format&gt;
      &lt;env.java.naming.factory.initial&gt;org.apache.activemq.jndi.ActiveMQInitialContextFactory&lt;/env.java.naming.factory.initial&gt;
      &lt;env.java.naming.provider.url&gt;tcp://localhost:61616&lt;/env.java.naming.provider.url&gt;
    &lt;/properties&gt;

      &lt;accept-options&gt;
        &lt;ws.bind&gt;localhost:8888&lt;/ws.bind&gt;
      &lt;/accept-options&gt;

    &lt;realm-name&gt;demo&lt;/realm-name&gt;

    &lt;cross-site-constraint&gt;
      &lt;allow-origin&gt;*&lt;/allow-origin&gt;
    &lt;/cross-site-constraint&gt;
  &lt;/service&gt;
  </pre>
      </li>
  <li>Save the <span class="code_inline">gateway-config.xml</span> file.</li>
  <li><p>Invoke the <span class="code_inline">gateway.start</span> command by navigating to the <span class="code_inline"><em>GATEWAY_HOME</em>/bin</span> directory where you installed the Gateway and then enter the following to run the <span class="code_inline">gateway.start</span> script:</p>
      <p><span class="code_inline">./gateway.start</span> (Mac and Linux)</p>
      <p><span class="code_inline">gateway.start.bat</span> (Windows)</p>
      <p>The output from the command will display that the Gateway is listening on:</p>
      <p><span class="code_inline">ws://10.0.2.2:8888/jms @ localhost:8888</span></p></li>
  </ol>

  <h2><a name="Build"></a>Test the Hybrid Android App</h2>
  <p>The following steps use the Android Emulator to test the hybrid Android app that you created.</p>
  <span class="note"><b>Notes:</b>
   <ul class="arrow-2">
     <li>Both the Gateway and Apache ActiveMQ must be running before testing the hybrid Android app.</li>
     <li><strong>When testing on Android devices:</strong> In order to connect the hybrid Android app on the Android device to the Gateway and Apache ActiveMQ, the Android device must be able to resolve the host name of computer running the Gateway on the network. This is the host name that you will use in the <strong>Location</strong> field of the hybrid Android app. For example, <span class="code_inline">ws://host_name:8001/jms</span>. You can also configure the Android device to use the IP Address of the computer running the Gateway (for example, <span class="code_inline">ws://192.168.4.86:8001/jms</span>). Using the IP Address is often the easiest method during testing.</li>
   </ul>
  </span>

  <ol>
    <li>In Terminal, ensure that you are in the root of the project directory (for example, <strong>myAndroidApp</strong>), and enter the following to see a list of all available Simulator targets: <code>cordova run android --list</code>. For this walkthrough, we will use <strong>Nexus_5_API_22_x86</strong>.</li>
    <li>To run the app in the Android Simulator, enter the following: <code>cordova run android --target="Nexus_5_API_22_x86"</code>. The Android Simulator opens and displays the hybrid Android app. It might take several minutes for the Android Simulator to launch and display the app. The app icon might appear on the Android Simulator screen for a while before displaying the GUI of the app. You might need to relaunch the app within the Android Simulator.</li>
    <li><p>In the hybrid app in the Android Simulator, click in the <strong>Location</strong> field, and enter the <code>jms</code> service URI <code>ws://10.0.2.2:8888/jms</code>, and click <strong>Connect</strong>.</p>
      <p>The <strong>Log messages</strong> field reports a successful connection. If the app does not connect, ensure that you have the Gateway and Apache ActiveMQ running.</p></li>
    <li>Play with hybrid app to see the full functionality.</li>
    <li>
    <p>For information on testing your hybrid Android app on an Android device, see <a href="http://developer.android.com/tools/device.html#setting-up">Setting up a Device for Development</a> and <a href="http://developer.android.com/tools/extras/oem-usb.html">OEM USB Drivers</a> in the Android developer documentation (<a href="http://developer.android.com/">http://developer.android.com</a>).</p>
    </li>
  </ol>

  <h2><a name="summary"></a>Summary</h2>
  <p>In this walkthrough, you learned how to turn one of the out of the box Kaazing WebSocket Gateway JavaScript JMS demos into a hybrid Android app. To learn how to build your own Kaazing WebSocket Gateway JMS apps, refer to the <a href="../index.html">documentation</a>.</p>

  <h2>Notes</h2>
  <p>Clients built using Kaazing WebSocket Gateway 3.x libraries will work against Kaazing WebSocket Gateway 4.x. If you wish to upgrade your 3.x client to the 4.x libraries, please note that the 3.x clients used a single JMS library and 4.x clients include and use separate WebSocket and JMS libraries. Update your client library file and code references to include both the WebSocket and JMS libraries, as described in the 4.x documentation. For more migration information, see <a href="p_dev_js_client.html#migrate">Migrate JavaScript Applications to Kaazing WebSocket Gateway 4.x.</a></p>


                  </section>
                </article>

            </div> <!-- #main -->
        </div> <!-- #main-container -->

    <footer>
  <div class="container">

    <div class="row text-center social-media">
      <a href="https://github.com/kaazing"><i class="fa fa-github" data-toggle="tooltip" data-placement="top" title="Github"></i></a>
      <a href="https://www.facebook.com/kaazing"><i class="fa fa-facebook" data-toggle="tooltip" data-placement="top" title="Facebook"></i></a>&nbsp;
      <a href="https://twitter.com/kaazing"><i class="fa fa-twitter" data-toggle="tooltip" data-placement="top" title="Twitter"></i></a>&nbsp;
      <a href="https://plus.google.com/+KaazingHome"><i class="fa fa-google-plus" data-toggle="tooltip" data-placement="top" title="Google Plus"></i></a>&nbsp;
      <a href="https://www.youtube.com/user/KaazingTV"><i class="fa fa-youtube" data-toggle="tooltip" data-placement="top" title="Youtube"></i></a>&nbsp;
      <a href="https://www.linkedin.com/company/kaazing-corporation"><i class="fa fa-linkedin" data-toggle="tooltip" data-placement="top" title="Linkedin"></i></a>&nbsp;
    </div>

    <div class="row copyright">
      <div class="col-xs-12 col-sm-5 text-left">
        &copy; 2007-2015 Kaazing Corporation
      </div>
      <div class="col-xs-12 col-sm-7 license">
        This website is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons BY-NC-SA</a>
      </div>
    </div>

  </div>
</footer>

<!-- start:javascript for this page -->










<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1771436-3', 'auto');
  ga('send', 'pageview');
  </script
  <!-- end:javascript for this page -->


</body>
</html>
