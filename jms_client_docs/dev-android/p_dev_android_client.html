<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Kaazing.com - Kaazing WebSocket Gateway 5 Docs</title>
    <link rel="icon" href="/img/favicon.ico">

  <link href='http://fonts.googleapis.com/css?family=Muli:300,400' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../assets/font-awesome-4.1.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="../../css/pygments.css">
  <link rel="stylesheet" href="../../css/main.css">
  <link rel="stylesheet" href="../../css/syntax.css">
  <link rel="stylesheet" href="../../css/doc.css">

  


<!-- +++++++++++++++Syntax Highlighter Calls++++++++++++++++ -->

<!-- Include required SyntaxHighlighter JS files -->
<script type="text/javascript" src="../../resources/xregexp.js"></script>
<script type="text/javascript" src="../../resources/shCore.js"></script>


<!--Include SyntaxHighlighter brushes. To test, using the JS brush -->
<script type="text/javascript" src="../../resources/shBrushJava.js"></script>
<script type="text/javascript" src="../../resources/shBrushAS3.js"></script>
<script type="text/javascript" src="../../resources/shBrushVb.js"></script>
<script type="text/javascript" src="../../resources/shBrushJScript.js"></script>
<script type="text/javascript" src="../../resources/shBrushCss.js"></script>
<script type="text/javascript" src="../../resources/shBrushPython.js"></script>
<script type="text/javascript" src="../../resources/shBrushXml.js"></script>

<!-- Include SyntaxHighlighter core style and Kaazing theme -->
<link href="../../resources/shCore.css" rel="stylesheet" type="text/css" />
<link href="../../resources/shThemeKaazing.css" rel="stylesheet" type="text/css" />

<!-- Finally, call SyntaxHighlighter -->
<script type="text/javascript">
   SyntaxHighlighter.all()
</script>

<!-- +++++++++++++++END OF Syntax Highlighter Calls++++++++++++++++ -->
</head>

<body>

    <!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="http://kaazing.com"><img id="kaazing-logo-header" src="../../img/Kaazing.png" alt="Kaazing.com"></img></a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav navbar-right">
				<li><a href="http://kaazing.com/documentation/">Documentation</a></li>
				<li><a href="http://developer.kaazing.com/downloads/">Downloads</a></li>
				<li><a href="http://developer.kaazing.com/product-demos/">Demos</a></li>
				<li><a href="https://blog.kaazing.com/">Blog</a></li>
				<li class="hidden-sm"><a href="https://kaazing.com/named-developer-program/">Developer Program</a></li>
			</ul>
		</div><!--/.nav-collapse -->
	</div>
</nav>

<div id="diagnostic">
</div>


    <div class="container page-content text-left">

  <link rel="stylesheet" href="/css/doc.css">

<div class="container page-content text-left">
<h1>Use the Kaazing Gateway Android JMS Client API</h1>

<p>In this procedure, you will learn how to create an Android JMS Client using the Kaazing Enterprise <a href="../apidoc/client/android/jms/index.html">Android JMS Client API</a>. You will learn how to create an Eclipse project and add the necessary Java classes in order to use the Android JMS Client API. You will learn how to implement the Android JMS Client API methods to enable your Android client to send and receive messages to a JMS broker via a local or publicly avaliable Gateway.</p>

<p>The <a href="../apidoc/client/java/jms/index.html">Android JMS Client API</a> is nearly identical to the Java JMS Client API. You can review an overview of the Java JMS Client API connection, session, message producer, and message consumer code in <a href="../dev-java/p_dev_java_client.html">Use the Kaazing Gateway Java JMS Client Library</a>. For information about using durable subscribers, see <a href="../dev-java/p_dev_java_client.html#durables">Durable Subscribers</a>.</p>


<p><span class="note"><strong>Note</strong>: For this how-to, we describe how to use both a local and a publicly available Gateway and JMS broker. The public address is <code>wss://sandbox.kaazing.net/jms</code>. Locally, you can use any JMS-compliant message broker. By default, the Gateway is configured to connect to the broker on <code>tcp://localhost:61613</code>. You can configure the <code>connect</code> URL in the file <span class="code_inline"><em>GATEWAY_HOME</em>/conf/gateway-config.xml</span>. See <a href="../../../integration-jms/o_jms_integrate">About Integrating Kaazing Gateway and JMS-Compliant Message Brokers</a> for more information.</span></p>


<p>In this procedure you will do the following <strong>major</strong> steps (these step numbers do not correspond to the procedure step numbers directly):</p>
<ol>
<li><a href="#Download">Download the Android ADT Bundle.</a></li>
<li><a href="#Install">Install the Android API.</a></li>
<li><a href="#setup">Set up an Android project in Eclipse.</a></li>
<li><a href="#Import">Import the Kaazing Gateway Android and JMS API libraries.</a></li>
<li><a href="#TUI">Create the Android client Touch User Interface (TUI).</a></li>
<li><a href="#dispatch">Add a dispatch queue class to the Android client.</a></li>
<li><a href="#common">Add the import statements for the common Java and Android classes.</a></li>
<li><a href="#API">Add the import statements for the Kaazing Gateway Android JMS Client API classes.</a></li>
<li><a href="#variables">Add the variables for the program.</a></li>
<li><a href="#onCreate">Add the <span class="code_inline">onCreate()</span> method with event listeners.</a></li>
<li><a href="#connect">Add the <span class="code_inline">connect()</span> and <span class="code_inline">disconnect()</span> methods.</a></li>
<li><a href="#getDestination">Add the <span class="code_inline">getDestination()</span> method for creating topics and queues.</a></li>
<li><a href="#ConnectionExceptionListener">Add the <span class="code_inline">ConnectionExceptionListener</span> class to handle when a JMS provider detects an exception.</a></li>
<li><a href="#DestinationMessageListener">Add the <span class="code_inline">DestinationMessageListener</span> class and <span class="code_inline">onMessage()</span> method to manage messages.</a></li>
<li><a href="#paused">Add the methods for when the client is paused, resumes, and when the client is closed.</a></li>
<li><a href="#updating">Add the methods for updating the <strong>Connect</strong> and <strong>Disconnect</strong> buttons.</a></li>
<li><a href="#Run">Run the Android client in the Android Emulator.</a></li>
<li><a href="#Test">Test the Android client in the Android Emulator.</a></li>
</ol>

<h2>Before You Begin</h2>
<p>This procedure is part of <a href="o_dev_android.html">Checklist: Build Android JMS Clients</a>.</p>

<p><span class="note"><b>Note:</b> Learn about supported browsers, operating systems, and platform versions in the <a href="../../release-notes.html">Release Notes</a>.</span></p>

<h2>Build the Android JMS Messaging Demo</h2>

<p><span class="note"><b>Note:</b> The following procedure uses the Android ADT Bundle (which includes the Eclipse IDE). You can download the Android ADT Bundle from <a href="http://developer.android.com/sdk/index.html">http://developer.android.com/sdk/index.html</a>.</span></p>

<ol>
  <li>Download the Kaazing Enterprise Android Client SDK as described in <a href="../../about/setup-guide">Setting Up the Gateway and Clients</a>.</li>
  <li>You will need a local copy of the Gateway to obtain the JMS API library file for the JMS specification, <strong>geronimo-jms_1.1_spec-1.1.1.jar</strong>. To download and install the Gateway, see <a href="../../about/setup-guide">Setting Up the Gateway and Clients</a>. </li>
  
  <li><a name="Download"></a>Download the Android ADT Bundle from <a href="http://developer.android.com/sdk/index.html">http://developer.android.com/sdk/index.html</a>. For information on using the Android SDK with an existing Eclipse IDE, see <a href="http://developer.android.com/sdk/installing/index.html">http://developer.android.com/sdk/installing/index.html</a>.</li>
  
  <li>To set up the ADT Bundle, see <a href="http://developer.android.com/sdk/installing/bundle.html">http://developer.android.com/sdk/installing/bundle.html</a>.</li>
  
  <li>Launch Eclipse from the installed ADT Bundle.</li>
  
  <li><a name="Install"></a>Install the Android API.
    <ol type="a">
      <li>In Eclipse, click <strong>Window</strong>, and then click <strong>Android SDK Manager</strong>.</li>
      <li>Select any package from <strong>Android 2.3.3</strong> or later and then click <strong>Install package</strong>.</li>
    </ol>
  </li>
  
  <li><a name="setup"></a>Set up an Android project in Eclipse.
    <ol type="a">
      <li>From the <strong>File</strong> menu, click <strong>New</strong> and then <strong>Android Application Project</strong>.</li>
      <li>In <strong>Application Name</strong>, name the project <strong>JMSDemoActivity</strong>.</li>
      <li>In <strong>Package Name</strong>, enter <strong>com.kaazing.gateway.jms.client.demo</strong>.</li>
      <li><p>In <strong>Minimum Required SDK</strong>, choose <strong>API 10: Android 2.3.3 (Gingerbread)</strong> and click <strong>Next</strong>.</p>
        <p><span class="note"><b>Note:</b> To confirm or modify the SDK requirement on a project, right-click the project and click <strong>Properties</strong>. Click <strong>Android</strong>, and then look at the <strong>Project Build Target</strong> settings.</span></p>
      </li>
      <li>On <strong>New Android Application</strong> page, click <strong>Next</strong>.</li>
      <li>On the <strong>Configure Launcher Icon</strong> page, in <strong>Image File</strong>, click <strong>Browse</strong>, navigate to the following location in the downloaded Kaazing Enterprise Android SDK and select the <strong>icon.png</strong> file:<br><code>demos/jms/res/drawable-hdpi/icon.pn</code></li>
      <li>Click <strong>Next</strong>. </li>
      <li>In <strong>Create Activity</strong>, select <strong>Blank Activity</strong> and click <strong>Next</strong>.</li>
      <li>In <strong>New Blank Activity</strong>, in <strong>Activity Name</strong>, enter <span class="code_inline">JMSDemoActivity</span>. </li>
      <li>In <strong>Layout Name</strong> enter <strong>main</strong> and click <strong>Finish</strong>. If there are dependencies that you need to install, the <strong>Finish</strong> button is not available. The new project is generated.</li>
    </ol>
  </li>

  <li><a name="Import"></a>Import the Kaazing Gateway Android and JMS API libraries.
    <ol type="a">
      <li>Right-click the new project and click <strong>Properties</strong>.</li>
      <li>In the <strong>Properties</strong> dialog, click <strong>Java Build Path</strong>, click the <strong>Libraries</strong> tab, and click <strong>Add External JARs</strong>.</li>
      <li>Locate and select the Kaazing Android libraries. The libraries are located in the downloaded Kaazing Enterprise Android Client SDK in <code>lib</code>. The libraries you need are <strong>com.kaazing.gateway.client.android-4.2.4</strong> and <strong>com.kaazing.gateway.jms.client.android-4.2.3</strong>.</li>
      <li>Click <strong>Add External JARs</strong> again.</li>
      <li>Locate and select the JMS API library. The JMS API library is located in <span class="code_inline"><em>GATEWAY_HOME</em>/lib</span>. The library is named <strong>geronimo-jms_1.1_spec-1.1.1.jar</strong>.</li>
      <li>In the <strong>Properties</strong> dialog, click <strong>OK</strong>. You can see the imported library and its classes in your project under <strong>Reference Libraries</strong>.</li>
    </ol>
  </li>
  <li><a name="TUI"></a>Create the Android client Touch User Interface (TUI). Next you will add the text strings and layout for the Android client TUI. When you are finished, the Android client will look like this:
      <figure>
        <img src="../images/android-TUI.png">
      <figcaption><strong>Figure: Android JMS Client TUI</strong></figcaption>  
      </figure>
  </li>

  <li>Open the <strong>strings.xml</strong> file located at <span class="code_inline">JMSDemoActivity/res/values/strings.xml</span> and replace its contents with the following:
<pre class="auto-links: false; brush: xml; toolbar: false;">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;resources&gt;
    &lt;string name=&quot;app_name_short&quot;&gt;JMS Demo&lt;/string&gt;
    &lt;string name=&quot;app_name&quot;&gt;JMS Messaging Demo&lt;/string&gt;
    &lt;string name=&quot;location_label&quot;&gt;Location&lt;/string&gt;
    &lt;string name=&quot;connectBtn_label&quot;&gt;Connect&lt;/string&gt;
    &lt;string name=&quot;disconnectBtn_label&quot;&gt;Disconnect&lt;/string&gt;
    &lt;string name=&quot;destination_label&quot;&gt;Destination&lt;/string&gt;
    &lt;string name=&quot;destination_default&quot;&gt;/topic/destination&lt;/string&gt;
    &lt;string name=&quot;location_default&quot;&gt;&lt;/string&gt;
    &lt;string name=&quot;subscribe_label&quot;&gt;Subscribe&lt;/string&gt;
    &lt;string name=&quot;unsubscribe_label&quot;&gt;Unsubscribe&lt;/string&gt;
    &lt;string name=&quot;message_label&quot;&gt;Message&lt;/string&gt;
    &lt;string name=&quot;message_default&quot;&gt;Hello, message&lt;/string&gt;
    &lt;string name=&quot;send_label&quot;&gt;Send&lt;/string&gt;
    &lt;string name=&quot;clear_label&quot;&gt;Clear&lt;/string&gt;
    &lt;string name=&quot;username_hint&quot;&gt;Username&lt;/string&gt;
    &lt;string name=&quot;password_hint&quot;&gt;Password&lt;/string&gt;
    &lt;string name=&quot;ok_label&quot;&gt;OK&lt;/string&gt;
    &lt;string name=&quot;cancel_label&quot;&gt;Cancel&lt;/string&gt;
    &lt;string name=&quot;sendBinary_label&quot;&gt;Send Binary&lt;/string&gt;
&lt;/resources&gt;
</pre>
  <p>You can see all of the buttons and values that will be displayed in the TUI. While the <span class="code_inline">location_default</span> field is empty here, you will enter the location into the Android client when you test it.</p>
  </li>
  
  <li>Open the <strong>main.xml</strong> file located at <span class="code_inline">JMSDemoActivity/res/layout/main.xml</span> and replace its contents with the following:
<pre class="auto-links: false; brush: xml; toolbar: false;">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:id=&quot;@+id/RelativeLayout1&quot;
    android:layout_width=&quot;fill_parent&quot;
    android:layout_height=&quot;fill_parent&quot;
    android:background=&quot;#F27A31&quot;&gt;

    &lt;LinearLayout
        android:id=&quot;@+id/linearLayout1&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentTop=&quot;true&quot;
        android:layout_centerHorizontal=&quot;true&quot;
        android:layout_margin=&quot;5dp&quot; &gt;

        &lt;TextView
            android:id=&quot;@+id/textView1&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/location_label&quot;
            android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;
            android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

        &lt;EditText
            android:id=&quot;@+id/locationText&quot;
            android:layout_width=&quot;0dp&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginLeft=&quot;5dp&quot;
            android:layout_weight=&quot;1&quot;
            android:ems=&quot;10&quot;
            android:text=&quot;@string/location_default&quot;
            android:textSize=&quot;@dimen/edit_text_size&quot; &gt;
            &lt;requestFocus /&gt;
        &lt;/EditText&gt;
      
    &lt;/LinearLayout&gt;

    &lt;Button
        android:id=&quot;@+id/disconnectBtn&quot;
        style=&quot;?android:attr/buttonStyleSmall&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:layout_below=&quot;@+id/linearLayout1&quot;
        android:layout_marginRight=&quot;5dp&quot;
        android:enabled=&quot;false&quot;
        android:text=&quot;@string/disconnectBtn_label&quot;
        android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

    &lt;Button
        android:id=&quot;@+id/connectBtn&quot;
        style=&quot;?android:attr/buttonStyleSmall&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignBaseline=&quot;@+id/disconnectBtn&quot;
        android:layout_alignBottom=&quot;@+id/disconnectBtn&quot;
        android:layout_toLeftOf=&quot;@+id/disconnectBtn&quot;
        android:text=&quot;@string/connectBtn_label&quot;
        android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

    &lt;LinearLayout
        android:id=&quot;@+id/linearLayout2&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentLeft=&quot;true&quot;
        android:layout_below=&quot;@+id/connectBtn&quot;
        android:layout_marginLeft=&quot;5dp&quot;
        android:layout_marginRight=&quot;5dp&quot; &gt;

        &lt;TextView
            android:id=&quot;@+id/textView2&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/destination_label&quot;
            android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;
            android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

        &lt;EditText
            android:id=&quot;@+id/destinationText&quot;
            android:layout_width=&quot;0dp&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginLeft=&quot;5dp&quot;
            android:layout_weight=&quot;1&quot;
            android:ems=&quot;10&quot;
            android:text=&quot;@string/destination_default&quot;
            android:textSize=&quot;@dimen/edit_text_size&quot; &gt;
        &lt;/EditText&gt;
    &lt;/LinearLayout&gt;

    &lt;Button
        android:id=&quot;@+id/subscribeBtn&quot;
        style=&quot;?android:attr/buttonStyleSmall&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignBaseline=&quot;@+id/unsubscribeBtn&quot;
        android:layout_alignBottom=&quot;@+id/unsubscribeBtn&quot;
        android:layout_below=&quot;@+id/linearLayout2&quot;
        android:layout_toLeftOf=&quot;@+id/unsubscribeBtn&quot;
        android:enabled=&quot;false&quot;
        android:text=&quot;@string/subscribe_label&quot;
        android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;
    &lt;Button
        android:id=&quot;@+id/unsubscribeBtn&quot;
        style=&quot;?android:attr/buttonStyleSmall&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:layout_below=&quot;@+id/linearLayout2&quot;
        android:layout_marginRight=&quot;5dp&quot;
        android:enabled=&quot;false&quot;
        android:text=&quot;@string/unsubscribe_label&quot;
        android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

    &lt;LinearLayout
        android:id=&quot;@+id/linearLayout3&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentLeft=&quot;true&quot;
        android:layout_below=&quot;@+id/subscribeBtn&quot;
        android:layout_marginLeft=&quot;5dp&quot;
        android:layout_marginRight=&quot;5dp&quot; &gt;

        &lt;TextView
            android:id=&quot;@+id/textView3&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;@string/message_label&quot;
            android:textAppearance=&quot;?android:attr/textAppearanceMedium&quot;
            android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

        &lt;EditText
            android:id=&quot;@+id/messageText&quot;
            android:layout_width=&quot;0dp&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginLeft=&quot;5dp&quot;
            android:layout_weight=&quot;1&quot;
            android:ems=&quot;10&quot;
            android:text=&quot;@string/message_default&quot;
            android:textSize=&quot;@dimen/edit_text_size&quot; &gt;
        &lt;/EditText&gt;
    &lt;/LinearLayout&gt;

    &lt;Button
        android:id=&quot;@+id/sendBtn&quot;
        style=&quot;?android:attr/buttonStyleSmall&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:layout_below=&quot;@+id/linearLayout3&quot;
        android:layout_marginRight=&quot;5dp&quot;
        android:enabled=&quot;false&quot;
        android:text=&quot;@string/send_label&quot;
        android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

    &lt;CheckBox
        android:id=&quot;@+id/sendBinaryCheckBox&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:layout_alignBottom=&quot;@+id/sendBtn&quot;
        android:layout_alignParentLeft=&quot;true&quot;
        android:layout_below=&quot;@id/linearLayout3&quot;
        android:text=&quot;@string/sendBinary_label&quot;
        android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

    &lt;LinearLayout
        android:id=&quot;@+id/logContainer&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;fill_parent&quot;
        android:orientation=&quot;vertical&quot;
        android:layout_below=&quot;@+id/sendBtn&quot;&gt;

        &lt;TextView
            android:id=&quot;@+id/logView&quot;
            android:layout_width=&quot;fill_parent&quot;
            android:layout_height=&quot;0dp&quot;
            android:layout_marginLeft=&quot;5dp&quot;
            android:layout_marginRight=&quot;5dp&quot;
            android:layout_weight=&quot;1&quot;
            android:background=&quot;@android:drawable/editbox_background&quot;
            android:scrollbars=&quot;horizontal|vertical&quot;
            android:textColor=&quot;#000000&quot;
            android:maxLines=&quot;80&quot;
            android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

        &lt;Button
            android:id=&quot;@+id/clearBtn&quot;
            style=&quot;?android:attr/buttonStyleSmall&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_gravity=&quot;right&quot;
            android:layout_marginRight=&quot;5dp&quot;
            android:text=&quot;@string/clear_label&quot;
            android:textSize=&quot;@dimen/edit_text_size&quot; /&gt;

    &lt;/LinearLayout&gt;
&lt;/RelativeLayout&gt;
</pre>
  </li>
  
  <li><a name="dispatch"></a>Add a dispatch queue class to the Android client. A dispatch queue class is used to run tasks in a separate thread from the main thread (to run some tasks asynchronously). The dispatch queue class is used to add <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Runnable.html">Runnable</a> in a queue. Runnable will be run in a first-in first-out basis. All of the blocking calls of the Android client will be run in a background thread so that the TUI is not blocked and can remain responsive.
    <ol type="a">
      <li>Right-click the package <strong>com.kaazing.gateway.client.demo</strong>, click <strong>New</strong>, and click <strong>Class</strong>.</li>
      <li>In <strong>Name</strong> enter <strong>DispatchQueue</strong> and click <strong>Finish</strong>. The new <strong>DispatchQueue.java</strong> class is added to the <strong>src</strong> folder.</li>
      <li>Double-click <strong>DispatchQueue.java</strong>.</li>
      <li>Replace the contents with the following code:
      
<pre class="auto-links: false; brush: java; toolbar: false;">
package com.kaazing.gateway.jms.client.demo;

import android.os.Handler;
import android.os.HandlerThread;

// The class is used to add Runnable in a queue and the runnable added to the queue 
// will be run in a first in first out basis. This class is useful to run
// a series of tasks sequentially in a separate thread from the main thread.
public class DispatchQueue extends HandlerThread {

  private Handler handler;

  public DispatchQueue(String name) {
    super(name);
  }

  // The message blocks until the thread is started. This should be called 
  // after call to start() to ensure the thread is ready.
  public void waitUntilReady() {
    handler = new Handler(getLooper());
  }

  // Adds the Runnable to the message queue which will be run on the thread.
  // The runnable will be run in a first in first out basis.
  public void dispatchAsync(Runnable task) {
    handler.post(task);
  }

  public void removePendingJobs() {
    handler.removeCallbacksAndMessages(null);
  }

}
</pre>
      </li>
    </ol>
  </li>
  
  <li>Modify the main class for the Android client. In the <strong>src</strong> folder for the project, under <strong>com.kaazing.gateway.jms.client.demo</strong>, double-click <strong>JMSDemoActivity.java</strong>. You will add the main Java code for the Android client in this file.</li>

  <li>Delete all of the contents except the <span class="code_inline">com.kaazing.gateway.jms.client.demo</span> package declaration and the <span class="code_inline">JMSDemoActivity</span> class declaration:
  
<pre class="auto-links: false; brush: java; toolbar: false;">
package com.kaazing.gateway.jms.client.demo;

  // Import statements will go here

  public class JMSDemoActivity extends FragmentActivity {

    // the remaining code will go here

}
</pre>
  
  </li>
  
  <li><a name="common"></a>Add the import statements for the common Java and Android classes. Add the statements directly after the package <span class="code_inline">com.kaazing.gateway.jms.client.demo</span> package declaration:
  
<pre class="auto-links: false; brush: java; toolbar: false;">
// General classes used for the program
import java.net.PasswordAuthentication;
import java.net.URI;
import java.util.ArrayDeque;
import java.util.Enumeration;
import java.util.HashMap;
import java.util.concurrent.Semaphore;
import java.util.logging.Level;
import java.util.logging.Logger;

// These classes are used for JMS connections and messages
import javax.jms.BytesMessage;
import javax.jms.Connection;
import javax.jms.Destination;
import javax.jms.ExceptionListener;
import javax.jms.JMSException;
import javax.jms.MapMessage;
import javax.jms.Message;
import javax.jms.MessageConsumer;
import javax.jms.MessageListener;
import javax.jms.MessageProducer;
import javax.jms.Session;
import javax.jms.TextMessage;

// These classes are used for the TUI
import android.os.Bundle;
import android.support.v4.app.FragmentActivity;
import android.text.method.ScrollingMovementMethod;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.CheckBox;
import android.widget.EditText;
import android.widget.TextView;
</pre>
  
  </li>


  <li><a name="API"></a>Add the import statements for the Kaazing Gateway Android JMS Client API classes.
  
<pre class="auto-links: false; brush: java; toolbar: false;">
// Include these statements with any client
import com.kaazing.net.ws.WebSocketFactory; // WebSocket
import com.kaazing.gateway.jms.client.JmsConnectionFactory; // JMS
import com.kaazing.gateway.jms.client.ConnectionDisconnectedException; // Exceptions
import com.kaazing.gateway.jms.client.util.Tracer; // Logging
import com.kaazing.net.http.HttpRedirectPolicy; // Sets HTTP redirect policy

// Include these statements when a client must authenticate with the Gateway
import com.kaazing.net.auth.BasicChallengeHandler;
import com.kaazing.net.auth.ChallengeHandler;
import com.kaazing.net.auth.LoginHandler;
</pre>
  
  </li>
  
  <li><a name="variables"></a>Add the variables for the program directly after the <span class="code_inline">JMSDemoActivity</span> class declaration.
  
<pre class="auto-links: false; brush: java; toolbar: false;">
public class JMSDemoActivity extends FragmentActivity {

  // Log API for send output to the log
  private static String TAG = &quot;com.kaazing.gateway.jms.client.android.demo&quot;;

  // Button variables
  private Button connectBtn;
  private Button disconnectBtn;
  private Button subscribeBtn;
  private Button unsubscribeBtn;
  private Button sendBtn;
  private Button clearBtn;
  private CheckBox sendBinaryCheckBox;
  
  // Text variables
  private EditText locationText;
  private EditText destinationText;
  private EditText messageText;
  private TextView logTextView;

  // Connection variables
  private JmsConnectionFactory connectionFactory;
  private Connection connection;
  private Session session;

  // Dispatch queue
  private DispatchQueue dispatchQueue;

  // Hash map holds active consumer instances created with destination string as a key
  private HashMap&lt;String, ArrayDeque&lt;MessageConsumer&gt;&gt; consumers = new HashMap&lt;String, 
    ArrayDeque&lt;MessageConsumer&gt;&gt;();
</pre>
  <p>The hash map uses an <a href="http://docs.oracle.com/javase/7/docs/api/java/util/ArrayDeque.html">array deque</a> for the MessageConsumer object. Array deques hold multiple elements prior to processing (deques) and have no capacity restrictions; they grow as necessary to support usage.</p>
  </li>
  
  <li><p><a name="onCreate"></a>Add the <span class="code_inline">onCreate()</span> method with event listeners.</p>
  <p>The <span class="code_inline">onCreate()</span> method is called when the activity is first created. This is a long method that includes event listeners for user actions in the TUI. The method also contains the <span class="code_inline">JmsConnectionFactory()</span> API call. The <span class="code_inline">JmsConnectionFactory()</span> is the JMS client implementation of ConnectionFactory. <span class="code_inline">JmsConnectionFactory()</span> is used to create a connection with a JMS provider via a WebSocket connection. <span class="code_inline">JmsConnectionFactory()</span> provides the ability to set the Gateway location dynamically.</p>
  
<pre class="auto-links: false; brush: java; toolbar: false;">
@Override
public void onCreate(Bundle savedInstanceState) {

  super.onCreate(savedInstanceState);
  Log.i(TAG, "onCreate");
  setContentView(R.layout.main);

  // Create variables for the TUI elements
  connectBtn      = (Button)findViewById(R.id.connectBtn);
  disconnectBtn   = (Button)findViewById(R.id.disconnectBtn);
  subscribeBtn    = (Button)findViewById(R.id.subscribeBtn);
  unsubscribeBtn  = (Button)findViewById(R.id.unsubscribeBtn);
  sendBtn         = (Button)findViewById(R.id.sendBtn);
  clearBtn        = (Button)findViewById(R.id.clearBtn);
  sendBinaryCheckBox = (CheckBox)findViewById(R.id.sendBinaryCheckBox);

  locationText    = (EditText)findViewById(R.id.locationText);
  destinationText = (EditText)findViewById(R.id.destinationText);
  messageText = (EditText)findViewById(R.id.messageText);

  logTextView     = (TextView)findViewById(R.id.logView);
  logTextView.setMovementMethod(new ScrollingMovementMethod());

  // Create the JMS connection factory and the underlying WebSocket factory
  // to create and establish WebSocket connection to send and receive 
  // JMS data over a WebSocket connection.
  if (connectionFactory == null) {
    try {
      connectionFactory = JmsConnectionFactory.createConnectionFactory();
      WebSocketFactory webSocketFactory = connectionFactory.getWebSocketFactory();
      
      // setDefaultFollowRedirect() sets the default HttpRedirectPolicy that is
      // inherited by all the WebSockets created using this factory instance.
      webSocketFactory.setDefaultFollowRedirect(HttpRedirectPolicy.SAME_DOMAIN);
    } catch (JMSException e) {
      e.printStackTrace();
      logMessage("EXCEPTION: " + e.getMessage());
    }
  }

  // Run when Connect button is clicked
  connectBtn.setOnClickListener(new OnClickListener() {           
    public void onClick(View v) {
      connectBtn.setEnabled(false);
      dispatchQueue = new DispatchQueue("DispatchQueue");
      dispatchQueue.start();
      dispatchQueue.waitUntilReady();

      // Call the connect() method defined later in this code
      connect();
    }            
  });
  
  // Run when Disconnect button is clicked
  disconnectBtn.setOnClickListener(new OnClickListener() {            
    public void onClick(View v) {
      // Call the disconnect() method defined later in this code
      disconnect();
    }
  });

  // Run when Subscribe button is clicked
  subscribeBtn.setOnClickListener(new OnClickListener() {
    public void onClick(View v) {
      // Get the destination name entered by the user
      final String destinationName = destinationText.getText().toString();
      logMessage("SUBSCRIBE - " + destinationName);
      dispatchQueue.dispatchAsync(new Runnable() {
        public void run() {
          try {
            Destination destination = getDestination(destinationName);
            if (destination == null) {
              return;
            }
            
            // Create a consumer using the destination
            MessageConsumer consumer = session.createConsumer(destination);
            
            // Create an array deque mapping consumers to the destination
            ArrayDeque&lt;MessageConsumer&gt; consumersToDestination = 
              consumers.get(destinationName);
              // If there is no consumers to destination map, add this new map
              if (consumersToDestination == null) {
                consumersToDestination = new ArrayDeque&lt;MessageConsumer&gt;();
                  consumers.put(destinationName, consumersToDestination);
                }
                // If there is a map, update it with the new consumer 
                consumersToDestination.add(consumer);
                // Set a message listener in the DestinationMessageListener() method
                consumer.setMessageListener(new DestinationMessageListener());
          } catch (JMSException e) {
            e.printStackTrace();
            logMessage("EXCEPTION: " + e.getMessage());
          }
        }
      });
    }
  });

  // Run when Unsubscribe button is clicked
  unsubscribeBtn.setOnClickListener(new OnClickListener() {        
    public void onClick(View v) {
      // Clear the queue created in subscribeBtn.setOnClickListener() 
      String destinationName = destinationText.getText().toString();
      logMessage("UNSUBSCRIBE - " + destinationName);
      ArrayDeque&lt;MessageConsumer&gt; consumersToDestination = consumers.get(destinationName);
      if (consumersToDestination == null) {
        return;
      }
      // Make MessageConsumer equal to the first element in the array deque 
      final MessageConsumer consumer = consumersToDestination.poll();
      if (consumer == null) {
        return;
      }
      dispatchQueue.dispatchAsync(new Runnable() {
        public void run() {
          try {
            // Close the consumer
            consumer.close();
          } catch (JMSException e) {
            e.printStackTrace();
            logMessage(e.getMessage());
          }
        }
      });
    }
  });

  // Run when Send button is clicked
  sendBtn.setOnClickListener(new OnClickListener() {
    public void onClick(View v) {
      // Get the message text
      final boolean sendBinary = sendBinaryCheckBox.isChecked();
      final String message = messageText.getText().toString();
      logMessage("SEND: " + message);
      dispatchQueue.dispatchAsync(new Runnable() {            
        public void run() {
          try {
            // Get the destination for the message
            String destinationName = destinationText.getText().toString();
            // Create a MessageProducer to send messages to the destination
            MessageProducer producer = 
              session.createProducer(getDestination(destinationName));
            // Add the message
            Message message;
            // Determine if the message is binary or text
            if (sendBinary) {
              BytesMessage bytesMessage = session.createBytesMessage();
              bytesMessage.writeUTF(text);
              message = bytesMessage;
            }
            else {
              message = session.createTextMessage(text);
            }

            // Send the message
            producer.send(message);
            // Close the producer
            producer.close();
          } catch (JMSException e) {
            e.printStackTrace();
            logMessage(e.getMessage());
          }
        }
      });
    }
  });

  // Run when Clear button is clicked
  clearBtn.setOnClickListener(new OnClickListener() {        
    public void onClick(View v) {
      // Clear the log
      logTextView.setText("");
    }
  });
}
</pre>
  </li>
  
  
  <li><a name="connect"></a>Add the <span class="code_inline">connect()</span> and <span class="code_inline">disconnect()</span> methods for connecting to the Gateway and updating the TUI.
  
<pre class="auto-links: false; brush: java; toolbar: false;">
private void connect() {
  logMessage("CONNECTING");

  // Since createConnection() is a blocking method that does not return until 
  // the connection is established or fails, it is a good practice to 
  // establish the connection on a separate thread and prevent the TUI from being blocked.
  dispatchQueue.dispatchAsync(new Runnable() {
    public void run() {
      try {
        // Get the location entered by the user
        String location = locationText.getText().toString();
        // Set the target Gateway location
        connectionFactory.setGatewayLocation(URI.create(location));
        // Create the connection to the Gateway
        connection = connectionFactory.createConnection();
        // Connect to the Gateway
        connection.start();

        // Create a Session object and set the client to 
        // acknowledge any messages it receives automatically
        session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
        logMessage("CONNECTED");
        // Set an exception listener for the client 
        connection.setExceptionListener(new ConnectionExceptionListener());    
        // Update the TUI 
        updateButtonsForConnected();
      } catch (Exception e) {
        updateButtonsForDisconnected();
        e.printStackTrace();
        logMessage("EXCEPTION: " + e.getMessage());
      }
    }
  });    
}

private void disconnect() {
  logMessage("DISCONNECTING");

  // Clear the queue of any pending messages
  dispatchQueue.removePendingJobs();
  dispatchQueue.quit();
  new Thread(new Runnable() {
    public void run() {
      try {
        // Close the connection
        connection.close();
        logMessage("DISCONNECTED");
      } catch (JMSException e) {
        e.printStackTrace();
        logMessage("EXCEPTION: " + e.getMessage());
      }
      finally {
        connection = null;
        // Update the TUI with the connection status
        updateButtonsForDisconnected();
      }
    }
  }).start();
}
</pre>
  <p>For more information on sessions and exception listeners, see the Java <a href="http://docs.oracle.com/javaee/7/api/javax/jms/Connection.html">Connection interface</a>.</p>
  </li>


  <li><a name="getDestination"></a>Add the <span class="code_inline">getDestination()</span> method for creating topics and queues.
  
<pre class="auto-links: false; brush: java; toolbar: false;">
private Destination getDestination(String destinationName) throws JMSException {
  Destination destination;
  // Create the topic using the destination name entered by the user
  if (destinationName.startsWith("/topic/")) {
    destination = session.createTopic(destinationName);
  }
  // Create the queue using the destination name entered by the user
  else if (destinationName.startsWith("/queue/")) {
    destination = session.createQueue(destinationName);
  }
  else {
    logMessage("Invalid destination name: " + destinationName);
    return null;
  }
  return destination;
}
</pre>
  <span class="note"><b>Notes:</b><br>
   <ul class="arrow-2">
     <li>When setting up your message consumers and producers, you must use the format <span class="code_inline">"/topic/"</span> for regular topics.</li>
     <li>The Kaazing Gateway Java JMS Client API supports the <a href="http://docs.oracle.com/cd/E19182-01/820-7853/6nj374las/index.html">Java Naming and Directory Interface (JNDI)</a>, but the Kaazing Gateway Android JMS Client API does not.</li>
   </ul>
  </span>
  </li>
  
  <li><a name="ConnectionExceptionListener"></a>Add the <span class="code_inline">ConnectionExceptionListener</span> class to handle when a JMS provider detects a serious problem with a connection object.
  
<pre class="auto-links: false; brush: java; toolbar: false;">
private class ConnectionExceptionListener implements ExceptionListener {

  public void onException(final JMSException exception) {
    logMessage(exception.getMessage());
    if (exception instanceof ConnectionDisconnectedException) {
      updateButtonsForDisconnected();
    }
  }
}
</pre>
    <p>For more information, see the Java <a href="http://docs.oracle.com/javaee/7/api/javax/jms/ExceptionListener.html">ExceptionListener</a> interface.</p>
  </li>
  
  <li><a name="DestinationMessageListener"></a>Add the <span class="code_inline">DestinationMessageListener</span> class and <span class="code_inline">onMessage()</span> method to manage messages. For more information, see the Java <a href="http://docs.oracle.com/javaee/7/api/javax/jms/MessageListener.html">MessageListener</a> interface.
  
<pre class="auto-links: false; brush: java; toolbar: false;">
private class DestinationMessageListener implements MessageListener {

  // Run when a message is received
  public void onMessage(Message message) {
    // This try block is used to handle both text and binary messages
    try {
      if (message instanceof TextMessage) {
        logMessage("RECEIVED TextMessage: " + ((TextMessage)message).getText());
      }
      else if (message instanceof BytesMessage) {
        BytesMessage bytesMessage = (BytesMessage)message;
        long len = bytesMessage.getBodyLength();
        byte b[] = new byte[(int)len];
        // Read a portion of the bytes message stream equal to its length
        bytesMessage.readBytes(b);
        // Send the bytes to the hexDump() method and display the string returned
        logMessage("RECEIVED BytesMessage: " + hexDump(b));
      }

      // This condition provides support for the Java MapMessage interface.
      // This client receives MapMessage messages, but it does not send them.
      // Review the Android JMS API for information on reading MapMessage messages.
      else if (message instanceof MapMessage) {
        MapMessage mapMessage = (MapMessage)message;
        Enumeration mapNames = mapMessage.getMapNames();
        while (mapNames.hasMoreElements()) {
          String key = (String)mapNames.nextElement();
          Object value = mapMessage.getObject(key);

          if (value == null) {
            logMessage(key + ": null");
          } else if (value instanceof byte[]) {
            byte[] arr = (byte[])value;
            StringBuilder s = new StringBuilder();
            s.append("[");
            for (int i = 0; i &lt; arr.length; i++) {
              if (i > 0) {
                s.append(",");
              }
              s.append(arr[i]);
            }
            s.append("]");
            logMessage(key + ": "+ s.toString() + " (Byte[])");
          } else {
            logMessage(key + ": " + value.toString() + 
              " (" + value.getClass().getSimpleName() + ")");
          }
        }
        logMessage("RECEIVED MapMessage: ");
      }
      else {
        logMessage("UNKNOWN MESSAGE TYPE: "+message.getClass().getSimpleName());
      }
    }
    catch (Exception ex) {
      ex.printStackTrace();
      logMessage("EXCEPTION: " + ex.getMessage());
    }
  }

  // Return a string representation of the bytes received
  private String hexDump(byte[] b) {
    if (b.length == 0) {
      return "empty";
    }
    StringBuilder out = new StringBuilder();
    for (int i=0; i &lt; b.length; i++) {
      out.append(Integer.toHexString(b[i])).append(' ');
    }
    return out.toString();
  }
}
</pre>
  <p>For more information on byte streams, see the Java <a href="http://docs.oracle.com/javaee/7/api/javax/jms/BytesMessage.html">BytesMessage</a> interface. For more information on MapMessage, see the Java <a href="http://docs.oracle.com/javaee/7/api/javax/jms/MapMessage.html">MapMessage</a> interface.</p>
  </li>
  
    <li><a name="paused"></a>Add the methods for when the client is paused, resumes, and when the client is closed.
    
<pre class="auto-links: false; brush: java; toolbar: false;">
// Run when the client is paused
public void onPause() {
  if (connection != null) {
    // Stop the connection in a separate thread
    dispatchQueue.dispatchAsync(new Runnable() {    
      @Override
      public void run() {
        try {
          connection.stop();
        } catch (JMSException e) {
          e.printStackTrace();
        }
      }
    });
  }
  super.onPause();
}

// Restart the connection when the client resumes activity
public void onResume() {
  if (connection != null) {
    dispatchQueue.dispatchAsync(new Runnable() {    
      @Override
      public void run() {
        try {
          connection.start();
        } catch (JMSException e) {
          e.printStackTrace();
        }
      }
    });
  }
  super.onResume();
  }

// Disconnect with the client is shutdown 
public void onDestroy() {
  if (connection != null) {
    disconnect();
  }
  super.onDestroy();
}
</pre>
  </li>
    
  <li><a name="updating"></a>Add the methods for updating the <strong>Connect</strong> and <strong>Disconnect</strong> buttons according to the state of the WebSocket connection.
  
<pre class="auto-links: false; brush: java; toolbar: false;">
// Run when the client is connected
private void updateButtonsForConnected() {
  runOnUiThread(new Runnable() {
    public void run() {
      connectBtn.setEnabled(false);
      disconnectBtn.setEnabled(true);
      subscribeBtn.setEnabled(true);
      unsubscribeBtn.setEnabled(true);
      sendBtn.setEnabled(true);
    }
  });
}

// Run when the client is disconnected    
private void updateButtonsForDisconnected() {
  runOnUiThread(new Runnable() {
    public void run() {
      connectBtn.setEnabled(true);
      disconnectBtn.setEnabled(false);
      subscribeBtn.setEnabled(false);
      sendBtn.setEnabled(false);
      unsubscribeBtn.setEnabled(false);
    }
  });
}
</pre>
  
  </li>
  
  <li>Add the <span class="code_inline">logMessage()</span> method for the <strong>Log</strong> area displayed in the client. This method keeps the log to a 100 line maximum.
  
<pre class="auto-links: false; brush: java; toolbar: false;">
private void logMessage(final String message) {
  runOnUiThread(new Runnable() {
    public void run() {
      // Clear log after 100 messages
      if (logTextView.getLineCount() > 100) {
        logTextView.setText(message);
      }
      else {
        logTextView.setText(message + "\n" + logTextView.getText());
      }
    }
  });
}
</pre>
  </li>
  
  <li>If you are using a local Gateway to test your Android JMS client, update the <span class="code_inline">jms</span> service on the Gateway configuration file to accept on your local IP address.
    <ol type="a">
      <li>Open the Gateway configuration file located at <span class="code_inline"><em>GATEWAY_HOME</em>/conf/gateway-config.xml</span>.</li>
      <li>Modify the <span class="code_inline">jms</span> service to accept connections containing your local IP address (replace <span class="code_inline">local-ip-address</span> with your IP address):
<pre class="auto-links: false; brush: xml; toolbar: false;">
&lt;service&gt;
  &lt;name&gt;JMS&lt;/name&gt;
  &lt;description&gt;JMS service to JMS server&lt;/description&gt;
  
  &lt;accept&gt;ws://build-macmini3.kaazing.test:${gateway.extras.port}/jms&lt;/accept&gt;
  &lt;accept&gt;ws://local-ip-address:${gateway.extras.port}/jms&lt;/accept&gt;
  &lt;type&gt;jms&lt;/type&gt;

  &lt;properties&gt;
    &lt;connection.factory.name&gt;ConnectionFactory&lt;/connection.factory.name&gt;
    &lt;context.lookup.topic.format&gt;dynamicTopics/%s&lt;/context.lookup.topic.format&gt;
    &lt;context.lookup.queue.format&gt;dynamicQueues/%s&lt;/context.lookup.queue.format&gt;
    &lt;env.java.naming.factory.initial&gt;
      org.apache.activemq.jndi.ActiveMQInitialContextFactory
    &lt;/env.java.naming.factory.initial&gt;
    &lt;env.java.naming.provider.url&gt;
      tcp://localhost:61616
    &lt;/env.java.naming.provider.url&gt;
  &lt;/properties&gt;

&lt;realm-name&gt;demo&lt;/realm-name&gt;

  &lt;cross-site-constraint&gt;
    &lt;allow-origin&gt;http://build-macmini3.kaazing.test:${gateway.extras.port}&lt;/allow-origin&gt;
  &lt;/cross-site-constraint&gt;
&lt;/service&gt;
</pre>
      </li>
      <li>Save the file, then restart the Gateway by following the steps in <a href="../../about/setup-guide">Setting Up the Gateway and Clients</a> (go to <code><em>GATEWAY_HOME</em>/bin</code>, and then run one of the following: for Linux/Mac: <code>./gateway.start</code>; for Windows: <code>gateway.start.bat</code>).</li>
      <li>If you are using a local Gateway, then start the Apache ActiveMQ broker provided by Kaazing. For steps on downloading and running the broker, see <a href="../../about/setup-guide">Setting Up the Gateway and Clients</a>.</li>
    </ol>
  </li>
  
  <li><a name="Run"></a>Run the Android client in the Android Emulator. In <strong>Eclipse</strong>, right-click the <strong>JMSDemoActivity</strong> project in Package Explorer, select <strong>Run As</strong>, and then click <strong>Android Application</strong>. The Android emulator launches.
    <figure>
      <img src="../images/android-TUI.png">
    <figcaption><strong>Figure: Android JMS Client in the Android Emulator</strong></figcaption>  
    </figure>
  </li>
  
  <li><a name="Test"></a>Test the Android client in the Android Emulator.
    <ol type="a">
      <li>In the <strong>Location</strong> field, enter either the URI used by the publicly available Gateway and JMS broker provided by Kaazing, <code>wss://sandbox.kaazing.net/jms</code>, or enter the local address <span class="code_inline">ws://<em>local-ip-address</em>:8001/jms</span> using your local IP address. For example, <span class="code_inline">ws://192.168.0.103:8001/jms</span>.</li>
      <li>Click <strong>Connect</strong>. The messages <span class="code_inline">CONNECTING</span> and then <span class="code_inline">CONNECTED</span> appear. The WebSocket connection to the Gateway and JMS broker was successful.</li>
      <li>Click <strong>Subscribe</strong>. The message <span class="code_inline">SUBSCRIBE - /topic/destination</span> appears. You have subscribed to the destination.</li>
      <li>Click <strong>Send</strong>. The following messages appear:<br>
        <span class="code_inline">RECEIVED TextMessage: Hello, message<br>
        SEND: Hello, message</span>
        <p>You sent a message <span class="code_inline">Hello, message</span> to the destination and received the same message because you are subscribed to that destination.</p>
      </li>
      <li>Click the <strong>Send Binary</strong> checkbox and click <strong>Send</strong> again. The following messages appear:<br>
      <span class="code_inline">SEND BytesMessage: Hello, message<br>
        RECEIVED BytesMessage: 0,14,72,101,108,108,111,44,32,109,101,115,115,97,103,101</span>
      </li>
      <li>Click <strong>Disconnect</strong> to end the session.</li>
    </ol>
  </li>
</ol>

<h2>Next Steps</h2>
<p><a href="p_dev_android_log.html">Display Logs for the Android JMS Client</a></p>

                  </section>
                </article>

            </div> <!-- #main -->
        </div> <!-- #main-container -->

    <footer>
  <div class="container">

    <div class="row text-center social-media">
      <a href="https://github.com/kaazing"><i class="fa fa-github" data-toggle="tooltip" data-placement="top" title="Github"></i></a>
      <a href="https://www.facebook.com/kaazing"><i class="fa fa-facebook" data-toggle="tooltip" data-placement="top" title="Facebook"></i></a>&nbsp;
      <a href="https://twitter.com/kaazing"><i class="fa fa-twitter" data-toggle="tooltip" data-placement="top" title="Twitter"></i></a>&nbsp;
      <a href="https://plus.google.com/+KaazingHome"><i class="fa fa-google-plus" data-toggle="tooltip" data-placement="top" title="Google Plus"></i></a>&nbsp;
      <a href="https://www.youtube.com/user/KaazingTV"><i class="fa fa-youtube" data-toggle="tooltip" data-placement="top" title="Youtube"></i></a>&nbsp;
      <a href="https://www.linkedin.com/company/kaazing-corporation"><i class="fa fa-linkedin" data-toggle="tooltip" data-placement="top" title="Linkedin"></i></a>&nbsp;
    </div>

    <div class="row copyright">
      <div class="col-xs-12 col-sm-5 text-left">
        &copy; 2007-2015 Kaazing Corporation
      </div>
      <div class="col-xs-12 col-sm-7 license">
        This website is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons BY-NC-SA</a>
      </div>
    </div>

  </div>
</footer>

<!-- start:javascript for this page -->










<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1771436-3', 'auto');
  ga('send', 'pageview');
  </script
  <!-- end:javascript for this page -->


</body>
</html>
