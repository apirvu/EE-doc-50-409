<!DOCTYPE html>
<html>

<head>

  <meta charset="UTF-8" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Kaazing.org - Kaazing.org Docs</title>
    <link rel="icon" href="/img/favicon.ico">

  <link href='http://fonts.googleapis.com/css?family=Muli:300,400' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../assets/font-awesome-4.1.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="../../css/pygments.css">
  <link rel="stylesheet" href="../../css/main.css">
  <link rel="stylesheet" href="../../css/syntax.css">
  <link rel="stylesheet" href="../../css/doc.css">




<!-- +++++++++++++++Syntax Highlighter Calls++++++++++++++++ -->

<!-- Include required SyntaxHighlighter JS files -->
<script type="text/javascript" src="../../resources/xregexp.js"></script>
<script type="text/javascript" src="../../resources/shCore.js"></script>


<!--Include SyntaxHighlighter brushes. To test, using the JS brush -->
<script type="text/javascript" src="../../resources/shBrushJava.js"></script>
<script type="text/javascript" src="../../resources/shBrushAS3.js"></script>
<script type="text/javascript" src="../../resources/shBrushVb.js"></script>
<script type="text/javascript" src="../../resources/shBrushJScript.js"></script>
<script type="text/javascript" src="../../resources/shBrushCss.js"></script>
<script type="text/javascript" src="../../resources/shBrushPython.js"></script>
<script type="text/javascript" src="../../resources/shBrushXml.js"></script>

<!-- Include SyntaxHighlighter core style and Kaazing theme -->
<link href="../../resources/shCore.css" rel="stylesheet" type="text/css" />
<link href="../../resources/shThemeKaazing.css" rel="stylesheet" type="text/css" />

<!-- Finally, call SyntaxHighlighter -->
<script type="text/javascript">
   SyntaxHighlighter.all()
</script>

<!-- +++++++++++++++END OF Syntax Highlighter Calls++++++++++++++++ -->
</head>

<body>

    <!-- Fixed navbar -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="../../index.html"><img id="kaazing-logo-header" src="../../img/Kaazing.png" alt="Kaazing.org"></img></a>
		</div>
		<div id="navbar" class="navbar-collapse collapse">
			<ul class="nav navbar-nav navbar-right">
				<li><a href="http://github.com/kaazing" target="_blank">GitHub</a></li>
				<li><a href="http://developer.kaazing.com/documentation/5.0/index.html">Documentation</a></li>
				<li><a href="http://kaazing.org/download">Download</a></li>
				<li><a href="http://kaazing.org/demos">Demos</a></li>
				<li><a href="http://kaazing.org/demos/quick-start">Quick Start</a></li>
				<li><a href="http://kaazing.org/blog">Blog</a></li>
				<li class="hidden-sm"><a href="http://kaazing.org/developer-subscription">Developer Subscription</a></li>
			</ul>
		</div><!--/.nav-collapse -->
	</div>
</nav>

<div id="diagnostic">
</div>


    <div class="container page-content text-left">

  <link rel="stylesheet" href="/css/doc.css">

<div class="container page-content text-left">
<h1>Use the Kaazing Gateway Objective-C JMS Client API</h1>
<p>In this procedure, you will learn how to create an iOS JMS client using the Kaazing Gateway Objective-C JMS client library. You will learn how to create an Xcode project and add the necessary frameworks in order to use the Objective-C JMS client library. You will learn how to implement the Objective-C JMS client library methods to enable your client to send and receive messages to your Apache ActiveMQ through the Gateway.</p>

<p>For information about deploying your Objective-C (iOS) client on devices with the arm64 architecture, see <a href="#arm64">Convert Your Objective-C (iOS) Client to a 64-Bit Runtime Environment</a>.</p>


<p><span class="note"><strong>Note</strong>: For this how-to, you can use any JMS-compliant message broker. By default, the Gateway is configured to connect to the server on tcp://localhost:61613. You can configure the connect URL in the file <span class="code_inline"><em>GATEWAY_HOME</em>/conf/gateway-config.xml</span>. See <a href="../../../integration-jms/o_jms_integrate">About Integrating Kaazing Gateway and JMS-Compliant Message Brokers</a> for more information.</span></p>


<p>In this procedure you will do the following:</p>
<ol>
<li>Set up your development environment using the Gateway and Xcode 4.4 or later.</li>
<li>Review the components that will be used to create the Objective-C client.</li>
<li>Create a new Xcode project.</li>
<li>Add the <strong>Kaazing Gateway Objective-C framework</strong>.</li>
<li>Add <strong>CFNetwork.framework</strong> to the project.</li>
<li>Add the <span class="code_inline">-ObjC</span> value to the <strong>Other Linker Flags</strong> build setting.</li>
<li>Build the interface for the client using <strong>MainStoryboard.storyboard</strong>.</li>
<li>Add the actions for the buttons to the view controller header file.</li>
<li>Add the <strong>StompConnectionListener</strong> to the <strong>JMSViewController.m</strong> implementation file.</li>
<li>Add the <strong>MessageListener</strong> to the <strong>JMSViewController.m</strong> implementation file.</li>
<li>Add the <strong>ExceptionListener</strong> to the <strong>JMSViewController.m</strong> implementation file.</li>
<li>Update the <strong>JMSViewController</strong> class in <strong>JMSViewController.m</strong> to use the <strong>StompConnectionListener</strong>, <strong>MessageListener</strong>, and <strong>ExceptionListener</strong> code.</li>
<li>Start Apache ActiveMQ and Kaazing Gateway.</li>
<li>Build and run the client in the iPhone Simulator.</li>
</ol>

<p>For information about the Kaazing Gateway Objective-C JMS client library, see <a href="../apidoc/client/ios/jms/KMStompJMS/index.html">Objective-C JMS Client API</a>.</p>

<span class="note"><b>Notes:</b>
 <ul class="arrow-2">
   <li>For information about durable subscribers, see <a href="#durable">Durable Subscribers</a>.</li>
   <li>This procedure assumes that you are familiar with Objective-C programming and are an advanced user of the <a href="https://developer.apple.com/xcode/">Xcode</a> IDE for creating native iOS clients. If you are new to Objective-C and Xcode, see <a href="http://klanguedoc.hubpages.com/hub/IOS-5-A-Beginners-Guide-to-Storyboard-Connection">A Beginnerâ€™s Guide to Storyboard</a>, <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/Introduction/Introduction.html#//apple_ref/doc/uid/TP40011210">Programming with Objective-C</a> and the tutorial <a href="https://developer.apple.com/library/ios/referencelibrary/GettingStarted/RoadMapiOS/FirstTutorial.html#//apple_ref/doc/uid/TP40011343-CH3-SW1">Start Developing iOS Apps Today</a>. An excellent video tutorial is <a href="http://thenewboston.org/list.php?cat=33">Objective-C</a> by <a href="http://www.thenewboston.org">thenewboston.org</a>. A very quick overview of Objective-C is <a href="http://cocoadevcentral.com/d/learn_objectivec/">Learn Objective-C</a> from <a href="http://cocoadevcentral.com/">Learn Cocoa</a>.</li>
   <li>This procedure assumes that you have the required iOS Developer Program credentials.</li>
   <li>The Xcode project created in this procedure uses features available in Xcode 4.1 or later and iOS SDK 5.0 and later.</li>
 </ul>
</span>

<h2>Before You Begin</h2>
<p>This procedure is part of <a href="o_dev_objc.html">Checklist: Build Objective-C (iOS) JMS Clients Using Kaazing Gateway</a>, that includes the following steps:</p>

<ol>
<li><strong>Use the Objective-C JMS Client API</strong></li>
<li><a href="p_dev_objc_secure.html">Secure Your Objective-C Client</a></li>
<li><a href="p_dev_objc_tshoot.html">Troubleshoot Your Objective-C JMS Client</a></li>
<!-- <li><a href="p_dev_objc_apns.html">Add APNs Support to Your Objective-C JMS Client</a></li> -->
<li><a href="p_dev_objc_log.html">Display Logs for the Objective-C JMS Client</a></li>
</ol>

<p><span class="note"><b>Note:</b> Learn about supported browsers, operating systems, and platform versions in the <a href="../../release-notes.html">Release Notes</a>.</span></p>

<h2>To Use the Kaazing Gateway Objective-C JMS Client API</h2>
<p>
<ol>
    <li>Set up your development environment using the following:
        <ul class="arrow-2">
            <li>Download and install Kaazing Gateway, as described in <a href="../../about/setup-guide">Setting Up Kaazing Gateway</a>.</li>
            <li>Download and install Apple <a href="https://developer.apple.com/xcode/">Xcode 4.4</a> or later (requires Mac OS X 10.7.4 or later). The Xcode bundle includes the iOS SDK.</li>
        </ul>
    </li>

    <li><p>Review the components that will be used to create the Objective-C client. A quick review of these components will give you an overview of how the client is constructed.</p>
        <table class="reference">
            <tr><th width="230px">Component</th><th>Description</th></tr>
            <tr><td>KGWebSocket.framework</td><td>Kaazing Gateway Objective-C WebSocket framework.</td></tr>
            <tr><td>KMStompJMS.framework</td><td>Kaazing Gateway Objective-C JMS framework.</td></tr>
            <tr><td>CFNetwork.framework</td><td>Core Foundation framework that provides a library of abstractions for network protocols. For more information on CFNetwork, see <a href="https://developer.apple.com/library/mac/#documentation/Networking/Conceptual/CFNetwork/Introduction/Introduction.html">Introduction to CFNetwork Programming Guide</a>.</td></tr>
            <tr><td>MainStoryboard.storyboard</td><td>The storyboard for the user interface look and feel and the interactive controls.</td></tr>
            <tr><td>JMSViewController.h</td><td>The header file that contains the target-action mechanism: how the user interface elements send an action message to an object that knows how to perform the corresponding action method (defined in JMSViewController.m).
In this file, user interface objects and outlet connections (connections between user interface objects and custom controller objects) are defined for the user interface controls. For more information, see <a href="http://developer.apple.com/library/mac/#documentation/General/Conceptual/CocoaEncyclopedia/Outlets/Outlets.html">Outlets</a>.</td></tr>
            <tr><td>JMSViewController.m</td><td>The implementation file (sometimes called a source file) where the architecture of the client is defined, including how the client responds to different events.</td></tr>
            <tr><td>StompConnectionListener class</td><td>The JMS listener interface for connection events, including the instance method implementations.</td></tr>
            <tr><td>MessageListener class</td><td>The JMS message listener interface, including the <span class="code_inline">onMessage:()</span> method.</td></tr>
            <tr><td>ExceptionListener class</td><td>The JMS exception listener interface, including the <span class="code_inline">onException:()</span> method.</td></tr>
            <tr><td>JMSViewController class</td><td>The fundamental view-management model for the client. This class defines how the clientâ€™s data and its visual appearance are linked. For more information, see <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIViewController_Class/Reference/Reference.html">UIViewController Class</a>.</td></tr>
        </table>
    </li>

    <li>Launch Xcode.</li>
    <li><p>Create a new Xcode project.</p>
        <ol type="a">
            <li>Click <strong>File</strong>, then <strong>New</strong>, and then <strong>Project</strong>.</li>
            <li><p>Under <strong>iOS</strong>, click <strong>Application</strong>, and click <strong>Single View Application</strong>. Click <strong>Next</strong>. The project options page appears.</p>
                    <figure>
                        <img src="../images/dev-io-client-project-options.jpg">
                    <figcaption><strong>Figure: Options for the Single View Application project</strong></figcaption>
                    </figure>
            </li>
            <li>Enter a name for your product in <strong>Product Name</strong>, such as <span class="code_inline">JMSDemo</span>, and a class prefix such as <span class="code_inline">JMS</span> in <strong>Class Prefix</strong>. Xcode uses the product name you entered to name your project and the client, and the class prefix to name the classes and files it generates for you.</li>
            <li>In <strong>Company Identifier</strong>, enter the name of your company.</li>
            <li>In <strong>Devices</strong>, make sure that <strong>iPhone</strong> is selected.</li>
            <li>Make sure that the <strong>Use Storyboards</strong> and <strong>Use Automatic Reference Counting</strong> options are selected and that the <strong>Include Unit Tests</strong> option is unselected.</li>
            <li>Click <strong>Next</strong>.</li>
            <li><p>Specify a location for your project (leave the <strong>Source Control</strong> option unselected) and then click <strong>Create</strong>.</p>
            <p>The new project is created along with the default files.</p>
                <figure>
                    <img src="../images/dev-ios-client-project.jpg">
                <figcaption><strong>Figure: New Xcode Project</strong></figcaption>
                </figure>
            </li>
        </ol>
    </li>

    <li><p>Next, add the Kaazing Gateway Objective-C framework to the project.</p>
        <ol type="a">
            <li><p>Navigate to the location of the Kaazing Gateway Objective-C frameworks:</p>
            <span class="code_inline"><em>GATEWAY_HOME</em>/lib/client/ios/</span></li>
            <li>Double-click the <strong>KMStompJMS.dmg</strong> and <strong>KGWebSocket.dmg</strong> images to mount them.</li>
            <li>Drag the <strong>KGWebSocket.framework</strong> folder from the mounted volume into the <strong>Frameworks</strong> folder in the Xcode project navigator.</li>
            <li><p>In the <strong>Choose options for adding these files</strong> dialog that appears, enable the <strong>Copy items into destination groupâ€™s folder</strong> checkbox, select your project in <strong>Add to targets</strong>, and click <strong>Finish</strong>.</p>
            <li>Repeat steps c and d for the <strong>KMStompJMS.framework</strong>.</li>
            <p>Xcode adds the frameworks to the project navigator, updates the <strong>Framework Search Paths</strong> setting in <strong>Build Settings</strong> with the path to the frameworks, and updates the <strong>Link Binary With Libraries</strong> settings in <strong>Build Phases</strong> automatically.</p></li>
            <p><strong>Note:</strong> You can also choose to add the <strong>KGWebSocket.framework</strong> and <strong>KMStompJMS.framework</strong> files into your local <strong>/Library/Frameworks/</strong> folder or a network share before adding them to your project. This is a common practice for managing frameworks.</p>
            </li>
        </ol>
    </li>

    <li><p>Add CFNetwork.framework to the project. CFNetwork is a framework in the iOS Core Services framework that provides a library of abstractions for network protocols.</p>
        <ol type="a">
            <li>In the project navigator, select the target to which you want to add a library or framework. In this example, <span class="code_inline">JMSDemo</span>.</li>
            <li>Click <strong>Build Phases</strong> at the top of the project editor.</li>
            <li>Open the <strong>Link Binary With Libraries</strong> section.</li>
            <li>Click the <strong>Add (+)</strong> button to add a library or framework.</li>
            <li><p>Enter <span class="code_inline">CFNetwork.framework</span> in the search field, select <strong>CFNetwork.framework</strong> in the results, and click <strong>Add</strong>.</p>
<p>The CFNetwork.framework is now listed in the <strong>Frameworks</strong> folder in the project navigator.</p></li>
        </ol>
    </li>

    <li><p>Add the <span class="code_inline">-ObjC</span> value to the <strong>Other Linker Flags</strong> build setting because the Kaazing Gateway Objective-C API code you add links against an Objective-C static library that contains categories. You must add this value to prevent a runtime exception of "selector not recognized". For more information, see <a href="http://developer.apple.com/library/mac/#qa/qa1490/_index.html">Building Objective-C static libraries with categories</a>.</p>
        <ol>
            <li>In the project navigator, select the target to which you want to add a library or framework. In this example, <span class="code_inline">JMSDemo</span>.</li>
            <li>Click the <strong>Build Settings</strong> tab and scroll down to the <strong>Linking</strong> section.</li>
            <li>In <strong>Other Linker Flags</strong>, add the value <span class="code_inline">-ObjC</span>.</li>
        </ol>
    </li>
  <li><p>Apply the <strong>-fobjc-arc-exceptions</strong> flag. By default in Objective-C, ARC is not exception-safe for normal releases. If the <strong>-fobjc-arc-exceptions</strong> flag is not specified, then the lifetime of <code>__strong</code> variables are not ended when their scopes are abnormally terminated by an exception. To enable exceptions, on the <strong>Build Settings</strong> tab, under <strong>Apple LLVM compiler 4.2 Language</strong>, expand <strong>Other C Flags</strong>, click the + button next to <strong>Release</strong> and add the flag <strong>-fobjc-arc-exceptions</strong>.</p>

    <p>For more information, see <a href="http://clang.llvm.org/docs/AutomaticReferenceCounting.html#exceptions">http://clang.llvm.org/docs/AutomaticReferenceCounting.html#exceptions</a>.</p>

    </li>
    <li><p>Build the interface for the client using <strong>MainStoryboard.storyboard</strong> and the View Controller.</p>
        <ol type="a">
            <li>Click <strong>MainStoryboard.storyboard</strong> in the project navigator. A blank scene appears.</li>
            <li>Expand <strong>View Controller</strong> in the editor area and click <strong>View</strong>.</li>
            <li>Click the <strong>Utility</strong> view to display the <a href="http://developer.apple.com/library/ios/#recipes/xcode_help-general/AbouttheUtilityArea/AbouttheUtilityArea.html">Utility area</a>.</li>
            <li>Show the Object Library, and choose <strong>Controls</strong> from the pop-up menu.</li>
            <li><p>Drag the following controls into the scene, and give them the values listed in the following table. You might want to add a background color to the scene in order to display controls clearly.</p>
                <table class="reference">
                    <tr><th width="100px">Control</th><th width="350px">Purpose</th><th>Value</th></tr>
                    <tr><td>Label</td><td>URI text label</td><td><span class="code_inline">URI:</span></td></tr>
                    <tr><td>Text Field</td><td>Field where users enter a WebSocket address</td><td><span class="code_inline">ws://localhost:8001/jms</span></td></tr>
                    <tr><td>Label</td><td>Destination label</td><td><span class="code_inline">Destination:</span></td></tr>
                    <tr><td>Button</td><td>Connect button</td><td><span class="code_inline">Connect</span></td></tr>
                    <tr><td>Button</td><td>Subscribe button</td><td><span class="code_inline">Subscribe</span></td></tr>
                    <tr><td>Button</td><td>Send button</td><td><span class="code_inline">Send </span></td></tr>
                    <tr><td>Text Field</td><td>Field where users enter the JMS destination</td><td><span class="code_inline">/topic/destination</span></td></tr>
                    <tr><td>Label</td><td>Message label</td><td><span class="code_inline">Message:</span></td></tr>
                    <tr><td>Text Field</td><td>Field where users enter a message</td><td><span class="code_inline">Hello, WebSocket</span></td></tr>
                    <tr><td>Text View</td><td>Area where the connection and subscription state is displayed, and where sent and received messages are displayed</td><td>No value</td></tr>
                    <tr><td>Button</td><td>Clear button that clears previous connection and message info</td><td><span class="code_inline">Clear</span></td></tr>
                </table>
                <p>When you are finished, the scene should look like the following:</p>
                    <figure>
                        <img src="../../images/dev-ios-client-view.jpg">
                    <figcaption><strong>Figure: Completed View Controller Scene</strong></figcaption>
                    </figure>
            </li>
        </ol>
    </li>

    <li><p>Add the actions for the buttons to the view controller header file. In our example, the file is named <span class="code_inline">JMSViewController.h</span>.</p>
        <ol type="a">
            <li><p>Modify the <span class="code_inline">JMSViewController</span> class as follows:</p>

<pre class="auto-links: false; brush: java; toolbar: false;">
#import &lt;UIKit/UIKit.h&gt;

// Declare the JMSViewController class and add the log and updateUI methods
@interface JMSViewController : UIViewController&lt;UITextFieldDelegate&gt;
- (void) log:(NSString *)str;
- (void) updateUI:(BOOL)connectStatus;
- (void) cleanup;</pre>
            </li>
            <li><p>Control-drag the UI controls into the <span class="code_inline">JMSViewController</span> class extension in JMSViewController.h to create actions and outlet connections (an outlet describes a connection between two objects). Configure the actions and outlet connections so that JMSViewController.h appears as follows:</p>

<pre class="auto-links: false; brush: java; toolbar: false; first-line: 7;">
/* Add the action method declarations. Corresponding stub methods
are added to JMSViewController.m automatically */
- (IBAction)connectOrDisconnect:(id)sender;
- (IBAction)subscribe:(id)sender;
- (IBAction)send:(id)sender;
- (IBAction)clear:(id)sender;

/* Add the outlet connections. Corresponding statements are added to the
viewDidLoad method in JMSViewController.m
automatically */
@property (weak, nonatomic) IBOutlet UIButton *connectDisconnectButton;
@property (weak, nonatomic) IBOutlet UIButton *sendButton;
@property (weak, nonatomic) IBOutlet UIButton *subscribeButton;
@property (weak, nonatomic) IBOutlet UIButton *clearButton;

@property (weak, nonatomic) IBOutlet UITextField *locationField;
@property (weak, nonatomic) IBOutlet UITextField *destinationField;
@property (weak, nonatomic) IBOutlet UITextField *messageField;
@property (weak, nonatomic) IBOutlet UITextView *logView;

@end</pre>

        <p>When you Control-drag the UI controls in the <span class="code_inline">JMSViewController</span>, the popover control appears:</p>

          <figure>
            <img src="../../images/dev-ios-popover-control.png">
          <figcaption><strong>Figure: The Xcode popover control</strong></figcaption>
          </figure>

        <p>For action method declarations (<span class="code_inline">IBAction</span>), choose <strong>Action</strong> in the the <strong>Connection</strong> drop-down. For outlet connections (<span class="code_inline">IBOutlet</span>), choose <strong>Outlet</strong> in the <strong>Connection</strong> drop-down. This is a common Xcode procedure. If you are unfamiliar with this procedure, see <a href="http://klanguedoc.hubpages.com/hub/IOS-5-A-Beginners-Guide-to-Storyboard-Connection">A Beginnerâ€™s Guide to Storyboard</a>.</p>

                <span class="note"><b>Notes:</b>
                 <ul class="arrow-2">
                     <li>For all of the buttons, ensure that <strong>Touch Up Inside</strong> is selected in the <strong>Sent Events</strong> section of the <strong>Connections Inspector</strong>. Xcode will likely configure this automatically.</li>
                   <li>While you can paste the above code into your header file, if you control-drag (press and hold the Control key while you drag the button to the implementation file in the assistant editor pane) the UI elements into the code from the scene and use the popover control to specify the outlet connections you can ensure that you have all the settings correct. This is a common Xcode procedure. If you are unfamiliar with this procedure, see <a href="http://klanguedoc.hubpages.com/hub/IOS-5-A-Beginners-Guide-to-Storyboard-Connection">A Beginnerâ€™s Guide to Storyboard</a>.</li>
                   <li>When you add the action methods, corresponding stub methods are added to the JMSViewController.m implementation file automatically. You will update these methods in JMSViewController.m with the Kaazing Gateway Objective-C API in later steps.</li>
                   <li>Some iOS clients define the interface in the implementation file instead of the header file. The client in this procedure defines the interface in the header file and the implementation methods in the implementation file.</li>
                 </ul>
                </span>
            </li>
      <li>Set the delegate for the text fields. In the view, Control-drag each text field to the yellow sphere in the scene dock (the view controller object). Select <span class="code_inline">delegate</span> in the <strong>Outlets</strong> section of the panel that appears. For more information, see <a href="http://klanguedoc.hubpages.com/hub/IOS-5-A-Beginners-Guide-to-Storyboard-Connection">A Beginnerâ€™s Guide to Storyboard</a>.</li>
        </ol>
    </li>
    <li><p>Add the <!-- APNs --> files <strong>JMSAppDelegate.h</strong> and <strong>JMSAppDelegate.m</strong> to the project. <!-- The APNs functionality is discussed in another topic, <a href="p_dev_objc_apns.html" title="Kaazing Developer Network">Add APNs Support to Your Objective-C JMS Client</a>, but the code you will add in the following steps includes some APNs functionality and without <strong>JMSAppDelegate.h</strong> and <strong>JMSAppDelegate.m</strong> Xcode will throw errors during building. --></p>
    <p>To add these files, drag them from <span class="uri"><em>GATEWAY_HOME</em>/demo/ios/src/jms/JMSDemo</span> to the <strong>JMSDemo</strong> project folder in Xcode.</p>
  </li>
    <li><p>In Xcode, click <strong>JMSViewController.m</strong>. You are going to modify this file to manage JMS communication to the Apache ActiveMQ via the Gateway.</p></li>

  <li><p>Replace the code in <strong>JMSViewController.m</strong> with the following code sample. The new code includes the following changes:</p>
    <ol type="a">
      <li>Add the import directive and class declaration below the import statement for JMSViewController.h (<code>#import "JMSViewController.h"</code>) (starts at line 1).</li>
      <li>Declare the <code>StompConnectionListener</code> class (starts at line 72).</li>
      <li>Declare the <code>MessageListener</code> class after the <code>StompConnectionListener</code> class (starts at line 111).</li>
      <li>Declare the <code>ExceptionListener</code> class after the <code>MessageListener</code> class (starts at line 174).</li>
      <li>Replace the <code>JMSViewController</code> class in <strong>JMSViewController.m</strong> with the <code>JMSViewController</code> class in the code sample to use the <code>StompConectionListener</code>, <code>MessageListener</code>, and <code>ExceptionListener</code> code (starts at line 201).</li>
    </ol>
  </li>
<pre class="auto-links: false; brush: java; toolbar: false; highlight:[1, 72, 111, 174, 201];">
#import &quot;JMSViewController.h&quot;
#import &quot;JMSAppDelegate.h&quot;
#import &lt;KMStompJMS/KMStompJMS.h&gt;
#import &lt;KGWebSocket/WebSocket.h&gt;

@class JMSViewController;


// --------------- LoginHandler Implementation ---------------
@interface DemoLoginHandler : KGLoginHandler
@end

@implementation DemoLoginHandler {
  int            _buttonIndex;
  NSString      *_username;
  NSString      *_password;
  UIAlertView   *_alertView;
}

-(void) dealloc {
}

- (id) init {
  NSLog(@&quot;[DemoLoginHandler init]&quot;);
  self = [super init];
  return self;
}

-(NSURLCredential *) credentials {

  _buttonIndex = -1;
  dispatch_async(dispatch_get_main_queue(), ^{
    [self popupLogin];
  });

  // Wait for click
  while (_buttonIndex &lt; 0) {
    [NSThread sleepForTimeInterval:.2];
  }

  // Clicked the Submit button
  if (_buttonIndex != 0) {
    return [[NSURLCredential alloc] initWithUser:_username password:_password persistence:NSURLCredentialPersistenceNone];
  } else {
    return nil;
  }
}

- (void) alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex {
  _username = [_alertView textFieldAtIndex:0].text;
  _password = [_alertView textFieldAtIndex:1].text;
  _buttonIndex = buttonIndex;
}

- (void) popupLogin {
  _buttonIndex = -1;

  _alertView = [[UIAlertView alloc] initWithTitle:@&quot;Please Login:&quot; message:nil
  delegate:self
  cancelButtonTitle:@&quot;Cancel&quot;
  otherButtonTitles:@&quot;OK&quot;, nil];

  _alertView.alertViewStyle = UIAlertViewStyleLoginAndPasswordInput;

  // Show alert on screen.
  [_alertView show];
}

@end


// --------------- StompConnectionListener Implementation ---------------

@interface JMSConnectionListener : NSObject&lt;KMStompConnectionListener&gt; {
  JMSViewController    *_controller;
}
@end

@implementation JMSConnectionListener

- (id) initWithController:(JMSViewController *)controller {
  self = [super init];
  if (self) {
    _controller = controller;
  }

  return self;
}

- (void) onConnect:(KMConnection *)connection {
  [_controller log:@&quot;CONNECTED&quot;];
  [_controller updateUI:YES];
}

- (void) onStart:(KMConnection *)connection {
  [_controller log:@&quot;CONNECTION STARTED&quot;];
}

- (void) onStop:(KMConnection *)connection {
  [_controller log:@&quot;STOPPED&quot;];
}

- (void) onClose:(KMConnection *)connection {
  [_controller log:@&quot;DISCONNECTED\n&quot;];
  [((JMSViewController *)_controller) cleanup];
  [_controller updateUI:NO];
}

@end

// -------------------- MessageListener Implementation -----------------
@interface JMSMessageListener : NSObject&lt;KMMessageListener&gt;
@end

@implementation JMSMessageListener {
  JMSViewController *_controller;
}

- (id) initWithController:(JMSViewController *)controller {
  self = [super init];
  if (self) {
    _controller = controller;
  }

  return self;
}

- (NSString *) typeFromObject:(NSObject *)value {
  if (value == nil) {
    return @&quot;nil&quot;;
  } else if ([value isKindOfClass:[NSString class]]) {
    return @&quot;NSString&quot;;
  } else if ([value isKindOfClass:[NSNumber class]]) {
    return @&quot;NSNumber&quot;;
  } else if ([value isKindOfClass:[NSData class]]) {
    return @&quot;NSData&quot;;
  } else if ([value isKindOfClass:[NSNull class]]) {
    return @&quot;NSNull&quot;;
  } else {
    return @&quot;UNKNOWN TYPE&quot;;
  }
}

- (void) onMessage:(KMMessage *)message {
  if ([message isKindOfClass:[KMTextMessage class]]) {
    KMTextMessage *textMessage = (KMTextMessage *)message;
    [_controller log:[NSString stringWithFormat:@&quot;RECEIVED KMTextMessage: %@&quot;, [textMessage text]]];

  } else if ([message isKindOfClass:[KMBytesMessage class]])  {
    KMBytesMessage *bytesMessage = (KMBytesMessage *)message;
    NSString *utf8String = [bytesMessage readUTF];
    [_controller log:[NSString stringWithFormat:@&quot;RECEIVED KMBytesMessage: %@&quot;, utf8String]];

  } else if ([message isKindOfClass:[KMMapMessage class]]) {
    KMMapMessage *mapMessage = (KMMapMessage *)message;
    [_controller log:[NSString stringWithFormat:@&quot;RECEIVED KMMapMessage:&quot;]];

    int count = 0;
    for (NSString *key in [mapMessage mapNames]) {
      id value = [mapMessage getObject:key];
      NSString *type = [self typeFromObject:value];
      [_controller log:[NSString stringWithFormat:@&quot;  %@: %@ (%@)&quot;, key, value, type]];
      count++;
    }
    [_controller log:[NSString stringWithFormat:@&quot;%d entries&quot;, count]];

  } else {
    [_controller log:@&quot;RECEIVED UNKNOWN MESSAGE&quot;];
  }
}

@end

// -------------------- ExceptionListener Implementation -----------------
@interface JMSExceptionListener : NSObject&lt;KMExceptionListener&gt;
@end

@implementation JMSExceptionListener {
  JMSViewController *_controller;
}

- (id) initWithController:(JMSViewController *)controller {
  self = [super init];
  if (self) {
    _controller = controller;
  }

  return self;
}

- (void) onException:(KMJMSException *)exception {
  NSString *msg = [exception reason];
  [_controller log:[NSString stringWithFormat:@&quot;EXCEPTION: %@&quot;, msg]];
  if ([exception isKindOfClass:[KMConnectionDisconnectedException class]]) {
    [((JMSViewController *)_controller) cleanup];
  }
}

@end

// -------------------- JMSViewController Implementation ---------------

@interface JMSViewController ()
-(KMDestination*) createDestination:(NSString*)destinationName;
@end

@implementation JMSViewController

@synthesize connectDisconnectButton;
@synthesize sendButton;
@synthesize subscribeButton;
@synthesize clearButton;

@synthesize locationField;
@synthesize destinationField;
@synthesize messageField;
@synthesize logView;

bool                      connected = NO;
KMStompConnectionFactory *factory = nil;
KMConnection             *conn = nil;
KMSession                *session = nil;
KMMessageProducer        *producer = nil;
KMMessageConsumer        *consumer = nil;


- (void) viewDidLoad {
  subscribeButton.enabled = NO;
  subscribeButton.alpha = 0.5f;
  sendButton.enabled = NO;
  sendButton.alpha = 0.5f;

  [[NSNotificationCenter defaultCenter] addObserver:self
  selector:@selector(suspendOrResume:)
  name:@&quot;suspendOrResume&quot;
  object:nil];
  [super viewDidLoad];
}

- (void) viewDidUnload {
  [self setLocationField:nil];
  [self setDestinationField:nil];
  [self setMessageField:nil];
  [self setLogView:nil];
  [self setConnectDisconnectButton:nil];
  [self setSendButton:nil];
  [self setSubscribeButton:nil];
  [self setClearButton:nil];

  subscribeButton.enabled = NO;
  subscribeButton.alpha = 0.5f;
  sendButton.enabled = NO;
  sendButton.alpha = 0.5f;

  [super viewDidUnload];
  // Release any retained subviews of the main view.
}

#pragma mark &lt;UIViewController Methods&gt;

- (BOOL) shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation {
  if ([[UIDevice currentDevice] userInterfaceIdiom] == UIUserInterfaceIdiomPhone) {
    return (interfaceOrientation != UIInterfaceOrientationPortraitUpsideDown);
  } else {
    return YES;
  }
}

#pragma mark &lt;UITextFieldDelegate Method&gt;

- (BOOL) textFieldShouldReturn:(UITextField *)theTextField {
  if ((theTextField == self.locationField)    ||
  (theTextField == self.destinationField) ||
  (theTextField == self.messageField)) {
    [theTextField resignFirstResponder];
  }
  return YES;
}

#pragma mark &lt;JMSViewController Methods&gt;

- (IBAction) connectOrDisconnect:(id)sender {
  // Cache values from the UI widgets in the main thread itself to avoid warnings/errors
  // related to UIKit invoked from secodary thread.
  NSString *location = [locationField text];

  dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    if (!connected) {
      NSURL                       *url = [[NSURL alloc] initWithString:location];
      KMStompConnectionProperties *props = [[KMStompConnectionProperties alloc] init];

      props-&gt;_connectionTimeout = 5000;

      @try {
        factory = [[KMStompConnectionFactory alloc] initWithUrl:url properties:props];

        KGWebSocketFactory   *webSocketFactory = [factory webSocketFactory];
        KGChallengeHandler   *challengeHandler = [self createBasicChallengeHandler];
        JMSAppDelegate       *delegate = [[UIApplication sharedApplication] delegate];
        NSData               *devToken = [delegate deviceToken];

        [webSocketFactory setDefaultChallengeHandler:challengeHandler];

        [self log:@&quot;CONNECTING&quot;];
        id&lt;KMStompConnectionListener&gt; listener = [[JMSConnectionListener alloc] initWithController:self];
        conn = [factory createConnectionWithListener:listener];
        [conn setExceptionListener:[[JMSExceptionListener alloc] initWithController:self]];
        [conn start];
        session = (KMSession *)[conn createSession:KMSessionAutoAcknowledge transacted:NO];

      }
      @catch (NSException *ex) {
        [self log:[NSString stringWithFormat:@&quot;EXCEPTION: %@&quot;, [ex reason]]];
        NSLog(@&quot;Exception: %@&quot;, [ex reason]);

        if (session != nil) {
          [session close];
        }

        if (conn != nil) {
          [conn close];
        }

        session = nil;
        conn = nil;
        factory = nil;
      }
    } else {
      connected = NO;
      [self log:@&quot;CLOSING&quot;];

      [session close];
      [conn close];
    }
  });
}

- (IBAction) subscribe:(id)sender {
  // Cache values from the UI widgets in the main thread itself to avoid warnings/errors
  // related to UIKit invoked from secondary thread.
  NSString      *destinationName = [destinationField text];

  // Subscribing can be a blocking operation, so perform it in the background.
  dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    @try {
      // Create a destination.
      KMDestination *dest = [self createDestination:destinationName];
      if (dest == nil) {
        return;
      }

      // Create a consumer and attach a listener.
      consumer = [session createConsumer:dest];
      [consumer setMessageListener:[[JMSMessageListener alloc] initWithController:self]];

      // Update the UI. These calls will schedule themselves in the main queue.
      [self log:[NSString stringWithFormat:@&quot;SUBSCRIBED TO: %@&quot;, destinationName]];
      [self disableSubscribeButton];
    }
    @catch (NSException *exception) {
      NSString *msg = [exception reason];
      [self log:[NSString stringWithFormat:@&quot;EXCEPTION: %@&quot;, msg]];

      if (consumer != nil) {
        [consumer close];
      }

      consumer = nil;
    }
  });
}

- (IBAction) send:(id)sender {
  // Cache values from the UI widgets in the main thread itself to avoid warnings/errors
  // related to UIKit invoked from secondary thread.
  NSString *destinationName = [destinationField text];
  NSString *messageText = [messageField text];

  // Sending a message is a blocking operation, so we do not want to
  // do that in the UI thread. Instead, we want to do it in the background.
  dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    @try {
      // Create a destination.
      KMDestination *dest = [self createDestination:destinationName];
      if (dest == nil) {
        return;
      }

      // Create a producer and message.
      producer = [session createProducer:dest];
      KMTextMessage *message = [session createTextMessage];

      // Set the message text and send it away.
      [message setText:messageText];
      [producer send:message];

      // Update the UI. This call will schedule itself in the main queue.
      [self log:[NSString stringWithFormat:@&quot;MESSAGE SENT TO %@: %@&quot;, destinationName, messageText]];
    }
    @catch (NSException *exception) {
      NSString *msg = [exception reason];
      [self log:[NSString stringWithFormat:@&quot;EXCEPTION: %@&quot;, msg]];

      if (producer != nil) {
        [producer close];
      }

      producer = nil;
    }
  });
}

- (IBAction) clear:(id)sender {
  dispatch_async(dispatch_get_main_queue(), ^{
    [logView setText:@&quot;&quot;];
  });
}

#pragma mark&lt;Private Methods&gt;

- (KGChallengeHandler *) createBasicChallengeHandler {
  // Set up ChallengeHandlers to handle authentication challenge.
  KGLoginHandler          *loginHandler = [[DemoLoginHandler alloc] init];
  KGBasicChallengeHandler *challengeHandler = [KGBasicChallengeHandler create];

  [challengeHandler setLoginHandler:loginHandler];
  return challengeHandler;
}

// Create a KMTopic or KMQueue depending on the text prefix inside the destination field.
- (KMDestination *) createDestination:(NSString*)destinationName {
  if ([destinationName hasPrefix:@&quot;/topic/&quot;]) {
    return [session createTopic:destinationName];
  }
  else if ([destinationName hasPrefix:@&quot;/queue/&quot;]) {
    return [session createQueue:destinationName];
  }

  // Make sure that the error dialog is shown in the main UI thread.
  dispatch_async(dispatch_get_main_queue(), ^{
    UIAlertView *badPrefixAlert = [[UIAlertView alloc] initWithTitle:@&quot;Invalid destination&quot;
    message:@&quot;Destination must begin with /topic/ or /queue/&quot;
    delegate:nil
    cancelButtonTitle:@&quot;OK&quot;
    otherButtonTitles:nil];
    [badPrefixAlert show];
  });

  return nil;
}

- (void) cleanup {
  if (producer != nil) {
    [producer close];
  }

  if (consumer != nil) {
    [consumer close];
  }

  if (session != nil) {
    [session close];
  }

  if (conn != nil) {
    [conn close];
  }

  producer = nil;
  session = nil;
  conn = nil;
  factory = nil;
}

- (void) log:(NSString *)str {
  dispatch_async(dispatch_get_main_queue(), ^{
    NSString *text = str;
    NSString *log = [logView text];

    if ((log != nil) &amp;&amp; ([log length] &gt; 0)) {
      text = [NSString stringWithFormat:@&quot;%@\n%@&quot;, [logView text], str];
    }

    // remove old text if text field is too large
    if ([[logView text] length] &gt; 5000) {
      text = [text substringFromIndex:3000];
    }

    [logView setText:text];
    [logView scrollRangeToVisible:NSMakeRange([logView.text length], 0)];
  });
}

- (void) disableSubscribeButton {
  dispatch_async(dispatch_get_main_queue(), ^{
    subscribeButton.enabled = NO;
    subscribeButton.alpha = 0.5f;
  });
}

- (void) suspendOrResume:(NSNotification *)notification {
  NSDictionary      *dict = [notification userInfo];
  NSString          *str = (NSString *) [dict valueForKey:@&quot;CONNECTION_STATE&quot;];
  JMSAppDelegate    *delegate = [[UIApplication sharedApplication] delegate];
  NSData            *devToken = [delegate deviceToken];

  if ([str isEqualToString:@&quot;resume&quot;]) {
    @try {
      if (devToken == nil) {
        // Application switched from background to foreground. Start the connection
        // if it was earlier connected.
        if (conn != nil) {
          [conn start];
        }
        return;
      }

      NSString                 *location = [locationField text];
      NSURL                    *url = [[NSURL alloc] initWithString:location];
      KMStompConnectionFactory *factory = [[KMStompConnectionFactory alloc] initWithUrl:url];
      KGWebSocketFactory       *webSocketFactory = [factory webSocketFactory];
      KGChallengeHandler       *challengeHandler = [self createBasicChallengeHandler];

      [webSocketFactory setDefaultChallengeHandler:challengeHandler];
      NSString *bundleId = [[NSBundle mainBundle] bundleIdentifier];

      [webSocketFactory setDefaultEnabledExtensions:enabledExtensions];

      [self log:@&quot;CONNECTING&quot;];
      id&lt;KMStompConnectionListener&gt; listener = [[JMSConnectionListener alloc] initWithController:self];
      conn = [factory createConnectionWithListener:listener];
      [conn setExceptionListener:[[JMSExceptionListener alloc] initWithController:self]];
      [conn start];
      session = (KMSession *)[conn createSession:KMSessionAutoAcknowledge transacted:NO];

      // Create a destination.
      NSString      *destinationName = [destinationField text];
      KMDestination *dest = [self createDestination:destinationName];
      if (dest == nil) {
        return;
      }

      // Create a consumer and attach a listener.
      consumer = [session createConsumer:dest];
      [consumer setMessageListener:[[JMSMessageListener alloc] initWithController:self]];


      // Update the UI. These calls will schedule themselves in the main queue.
      [self log:[NSString stringWithFormat:@&quot;SUBSCRIBED TO: %@&quot;, destinationName]];
      connected = YES;
      [self updateUI:YES];
      [self disableSubscribeButton];
    }
    @catch (NSException *ex) {
      [self log:[NSString stringWithFormat:@&quot;EXCEPTION: %@&quot;, [ex reason]]];
      NSLog(@&quot;Exception: %@&quot;, [ex reason]);

      if (consumer != nil) {
        [consumer close];
      }

      if (session != nil) {
        [session close];
      }

      if (conn != nil) {
        [conn close];
      }

      consumer = nil;
      session = nil;
      conn = nil;
    }
  }
  else { // suspend
    @try {
      if (devToken == nil) {
        // Application switched from foreground to background. Stop the connection
        // if it was connected.
        if (conn != nil) {
          [conn stop];
        }
        return;
      }
    }
    @catch (NSException *ex) {
      [self log:[NSString stringWithFormat:@&quot;EXCEPTION: %@&quot;, [ex reason]]];
      NSLog(@&quot;Exception: %@&quot;, [ex reason]);
    }
  }
}

- (void) updateUI:(BOOL)connectStatus {
  dispatch_async(dispatch_get_main_queue(), ^{
    if (connectStatus) {
      [connectDisconnectButton setTitle:@&quot;Disconnect&quot; forState:UIControlStateNormal];
      connected = YES;
      subscribeButton.enabled = YES;
      subscribeButton.alpha = 1.0f;
      sendButton.enabled = YES;
      sendButton.alpha = 1.0f;
    } else {
      [connectDisconnectButton setTitle:@&quot;Connect&quot; forState:UIControlStateNormal];
      connected = NO;
      subscribeButton.enabled = NO;
      subscribeButton.alpha = 0.5f;
      sendButton.enabled = NO;
      sendButton.alpha = 0.5f;
    }
  });
}

@end
</pre>
    <li>Start Apache ActiveMQ. For steps on starting Apache ActiveMQ, see the setup information for Apache ActiveMQ.</li>
    <li><p>Confirm that the Kaazing Gateway has the default <span class="code_inline">jms</span> service in <span class="code_inline"><em>GATEWAY_HOME</em>/conf/gateway-config.xml</span>, and then start the Gateway.</p>
<pre class="brush: xml; toolbar: false;">
&lt;service&gt;
    &lt;accept&gt;ws://build-macmini3.kaazing.test:${gateway.extras.port}/jms&lt;/accept&gt;
    &lt;type&gt;jms&lt;/type&gt;
    &lt;properties&gt;
        &lt;connection.factory.name&gt;ConnectionFactory&lt;/connection.factory.name&gt;
        &lt;context.lookup.topic.format&gt;dynamicTopics/%s&lt;/context.lookup.topic.format&gt;
        &lt;context.lookup.queue.format&gt;dynamicQueues/%s&lt;/context.lookup.queue.format&gt;
        &lt;env.java.naming.factory.initial&gt;
        org.apache.activemq.jndi.ActiveMQInitialContextFactory
        &lt;/env.java.naming.factory.initial&gt;
        &lt;env.java.naming.provider.url&gt;
        tcp://localhost:61616
        &lt;/env.java.naming.provider.url&gt;
    &lt;/properties&gt;

    &lt;realm-name&gt;demo&lt;/realm-name&gt;
    &lt;!--
    &lt;authorization-constraint&gt;
     &lt;require-role&gt;AUTHORIZED&lt;/require-role&gt;
    &lt;/authorization-constraint&gt;
    --&gt;
    &lt;cross-site-constraint&gt;
         &lt;allow-origin&gt;http://build-macmini3.kaazing.test:${gateway.extras.port}&lt;/allow-origin&gt;
    &lt;/cross-site-constraint&gt;
&lt;/service&gt;
</pre>

    </li>
    <li><p>Build and run the client in the iPhone Simulator.</p>
        <ol type="a">
            <li>In the <strong>Scheme</strong> menu, select <strong>iPhone 5.1 Simulator</strong> (you might have a more recent version such as iPhone 6.1).
                    <figure>
                        <img src="../images/dev-ios-client-scheme.jpg">
                    <figcaption><strong>Figure: Scheme using iPhone 5.1 Simulator</strong></figcaption>
                    </figure>
            </li>
            <li><p>Click <strong>Run</strong>.</p>
                <p>The iPhone Simulator displays the client.</p>
                <figure>
                    <img src="../images/dev-ios-client-simulator.jpg">
                <figcaption><strong>Figure: Your JMS Demo client on the iPhone Simulator</strong></figcaption>
                </figure>
            </li>
            <li>Click <strong>Connect</strong>. The client connects to the JMS service via a publicly available instance of the Gateway.</li>
            <li>Click <strong>Subscribe</strong>. You are now subscribed to the topic.</li>
            <li>Click <strong>Send</strong>. The message is sent and the received instantly because you are a subscriber.</li>
            <li>Click <strong>Disconnect</strong> to end the connection.</li>
        </ol>
    </li>
</ol>
</p>

<h2><a name="migrate"></a>Migrate iOS Applications to Kaazing Gateway 4.x</h2>
<p>If you wish to migrate your Kaazing Gateway 3.3-3.5 iOS clients to Kaazing Gateway 4.x and use its new library, do the following:</p>
  <ol>
  <li>Add the new KGWebSocket.framework in Gateway 4.x to your client, as described in the above procedure.</li>
  <li>Add the new KMStompJMS.framework in Gateway 4.x to your client, as described in the above procedure. This has replaced the KMStompJMS.framework from 3.3-3.5.</li>
  <li>Change any KMStompJMS references to both KGWebSocket and KMStompJMS, such as in the import statements in <strong>JMSViewController.m</strong> above (<code>#import &lt;KGWebSocket/WebSocket.h&gt;, #import &lt;KMStompJMS/KMStompJMS.h&gt;</code>). You do not need to change any instances of <code>KMStompConnectionFactory</code>.</li>
  <li><p>Modify challenge handlers. In Kaazing Gateway 4.x, the <code>KGChallengeHandlers</code> class from 3.3-3.5 was replaced with by the <code>KGChallengeHandler</code> modifier of the <code>WebSocketFactory</code> class. The <code>KGChallengeHandler</code> modifier is used during authentication for connections and subsequent revalidation that occurs at regular intervals.</p>

    <p>Kaazing Gateway 3.3-3.5:</p>

<pre class="auto-links: false; brush: java; toolbar: false;">
// Set up ChallengeHandlers to handle authentication challenge.
KGLoginHandler          *loginHandler = [[DemoLoginHandler alloc] init];
KGBasicChallengeHandler *challengeHandler = [KGChallengeHandlers load:@"KGBasicChallengeHandler"];

[challengeHandler setLoginHandler:loginHandler];
[KGChallengeHandlers setDefault:challengeHandler];
</pre>

    <p>Kaazing Gateway 4.x:</p>

<pre class="auto-links: false; brush: js; toolbar: false;">
- (KGChallengeHandler *) createBasicChallengeHandler {
    // Set up ChallengeHandlers to handle authentication challenge.
    KGLoginHandler          *loginHandler = [[DemoLoginHandler alloc] init];
    KGBasicChallengeHandler *challengeHandler = [KGBasicChallengeHandler create];

    [challengeHandler setLoginHandler:loginHandler];
    return challengeHandler;
}
</pre>
  </li>
  <li>Review the <a href="../apidoc/client/ios/jms/KMStompJMS/index.html">Objective-C JMS Client API</a>.</li>
</ol>

<a name="durable"></a><h2>Durable Subscribers</h2>

<span class="note"><b>Note:</b> Currently, the Gateway does not support durable subscribers with Apache ActiveMQ. You may use durable subscribers with <a href="../../../integration-jms/p_jms_integrate_tibco">TIBCO EMS</a> or <a href="../../../integration-jms/p_jms_integrate_informatica">Informatica UM</a>. For more information, see <a href="../../../admin-reference/r_conf_jms/index.html#durable-subscribers">Durable Subscribers</a>.</span>


<p>If your JMS client needs to receive all of the messages published on a topic, including the ones published while the subscriber is inactive because it is not being used or has lost connections (which is common when using mobile devices), create a durable <code>KMTopicSubscriber</code> using the <span class="code_inline">createDurableSubscriber</span> method on the <code>KMSession</code> object.</p>

<p>To unsubscribe from a durable topic, use the <span class="code_inline"><a href="../apidoc/client/ios/jms/KMStompJMS/Classes/KMSession.html#//api/name/unsubscribe:">- unsubscribe</a></span> method of the <code>KMSession</code> object.</p>

<p>The JMS provider retains a separate record of each durable subscription and ensures that all messages from the topic's publishers are retained until they are acknowledged by each durable subscriber or they have expired. Whether messages have been acknowledged is tracked separately for each durable subscriber, and each durable subscriber is identified by the combination of its name and the clientID (if any) set on the Connection. Ensure your application confirms that the clientID (if used) is unique to the user or device, or, if it does not use clientID's, ensure that the durable name is unique to the user or device.</p>

<p><span class="note"><b>Note:</b> The following code example is not intended to be integrated into the iOS JMS client created earlier in this topic. The following example is a separate iOS JMS client that demonstrates durable subscribers.</span></p>

<h3>Example</h3>
<p>The following code shows the interface and implementation of the JMSDurableSubscriberMessageListener API.</p>

<pre class="auto-links: false; brush: js; toolbar: false;">
@interface JMSDurableSubscriberMessageListener : NSObject&lt;KMMessageListener&gt;
@end

@implementation JMSDurableSubscriberMessageListener {
    NSString *_expectedValue;
}

- (void) onMessage:(KMMessage *)message {
    KMTextMessage *textMsg = (KMTextMessage *)message;
    NSString      *text = [textMsg text];
    NSLog(@&quot;RECEIVED MESSAGE: %@&quot;, text);
}
@end</pre>

<p>The following snippet, which is not part of the preceding class, creates the connection and the durable subscription. It provides examples of creating a durable subscription with and without a message selector.</p>

<pre class="auto-links: false; brush: js; toolbar: false; hightlight:[];">
.
.
.
- (void) receiveMessageUsingDurableSubscriber:(BOOL)withMessageSelector {
    // Create a KMConnectionListener.
    id&lt;KMStompConnectionListener&gt; listener = [
        [JMSDurableSubscriptionConnectionListener alloc] init];

    KMConnection *conn = [super createConnectionWithListener:listener];
    [conn start];

    KMSession *session = [conn createSession:KMSessionAutoAcknowledge
        transacted:NO];
    KMTopic *topic = [session createTopic:@&quot;/topic/destination&quot;];

    // Create a durable subscriber.
    KMMessageConsumer *consumer = nil;
    NSString *expectedValue = nil;

    // Without Message Selector
    if (!withMessageSelector) {
        consumer = [session createDurableSubscriber:topic name:@&quot;durable1&quot;];
        expectedValue = @&quot;Hello, Durable Subscriber!&quot;;
    }

    // With Message Selector
    else {
        consumer = [session createDurableSubscriber:topic
        name:@&quot;durable1&quot;
        messageSelector:@&quot;symbol=&#x27;KZNG&#x27;&quot;
        noLocal:NO];
        expectedValue = @&quot;Hello, Durable Subscriber with MessageSelector!&quot;;
    }

    [consumer setMessageListener:[[JMSDurableSubscriberMessageListener alloc]
        initWithTestcase:self expectedValue:expectedValue]];

    [consumer close];

    // Unsubscribe durable subscriber
    [session unsubscribe:@&quot;durable1&quot;];

    sleep(3);

    [session close];
    [conn close];
}
</pre>

<p>When using message selectors, the same string value is used by methods sending or receiving messages with a message selector. You can see that the <span class="code_inline">receiveMessageUsingDurableSubscriber</span> method above uses a message selector string (line 26). A send method should have a condition such as:</p>

<pre class="auto-links: false; brush: js; toolbar: false;">
if (withMessageSelector) {
    [textMsg setStringProperty:@"symbol" value:@"KZNG"];
}
</pre>

<p>Durable subscriptions do not require message selectors. Nor are message selectors limited to durable subscriptions. The preceding example simply shows a common combination of durable subscriptions and message selectors.</p>

<h2><a name="arm64"></a>Convert Your Objective-C (iOS) Client to a 64-Bit Runtime Environment</h2>
<p>iPhone 5s, iPad Air and iPad mini (2nd generation) both run on a completely new processor architecture: arm64. arm64 is the standard, 64-Bit architecture in Xcode 5.0.1. You can use Xcode 5.0.1 to update your Objective-C (iOS) client to support arm64. For more information, see <a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/CocoaTouch64BitGuide/ConvertingYourAppto64-Bit/ConvertingYourAppto64-Bit.html">Converting Your App to a 64-Bit Binary</a>.</p>

<p>To update your Objective-C (iOS) client to support arm64:</p>
<ol>
<li>Install Xcode 5.0.1 or later from the <a href="https://itunes.apple.com/us/app/xcode/id497799835?mt=12">Mac App Store</a>.</li>
<li>Open your Objective-C (iOS) client project. Xcode prompts you to modernize your project. Modernizing the project adds new warnings and errors that are important when compiling your app for 64-bit.</li>
<li>Update your project settings to support iOS 5.1.1 or later. You cannot build a 64-bit project if it targets an iOS version earlier than iOS 5.1. Change the <strong>Architectures</strong> build setting in your project to <strong>Standard Architectures (including 64-bit)</strong>. Set the <strong>Deployment Target</strong> to <strong>7.1</strong>. For more information, see <a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/CocoaTouch64BitGuide/ConvertingYourAppto64-Bit/ConvertingYourAppto64-Bit.html">Converting Your App to a 64-Bit Binary</a>.</li>
</ol>

<h2>Next Step</h2>
<p><a href="p_dev_objc_secure.html">Secure Your Objective-C Client</a></p>

<h2>Notes</h2>
<ul class="arrow-2">
    <li>Clients built using Kaazing Gateway 3.x libraries will work against Kaazing Gateway 4.x. If you wish to upgrade your 3.x client to the 4.x libraries, please note that the 3.x clients used a single Stomp JMS library and 4.x clients include and use separate WebSocket and Stomp JMS libraries. Update your client library file and code references to include both the WebSocket and Stomp JMS libraries, as described in the 4.x documentation.</li>
    <li>For information about the <span class="code_inline">dispatch_get_global_queue</span> and <span class="code_inline">dispatch_get_main_queue</span> functions used in the JMSViewController implementation, see <a href="http://developer.apple.com/library/ios/#documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html">Dispatch Queues</a> in the <a href="http://developer.apple.com/library/ios/#documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html">Concurrency Programming Guide of the iOS Developer Library</a>.</li>
    <li><a href="http://developer.apple.com/library/ios/#documentation/Xcode/Conceptual/ios_development_workflow/40-iOS_Development_Troubleshooting_Guide/ios_development_troubleshooting.html">iOS Development: Troubleshooting</a></li>
    <li><span class="code_inline">TemporaryTopic</span> and <span class="code_inline">TemporaryQueue</span> objects are destroyed when the client loses its connection to the Gateway, or when the JMS-compliant message broker loses its connection to the Gateway. To address this, monitor the client's exception listener to handle recovery for your application. Once the connection is re-established, recreate <span class="code_inline">TemporaryTopic</span> and <span class="code_inline">TemporaryQueue</span>. <span class="code_inline">ConnectionDroppedException</span> and <span class="code_inline">ConnectionInterruptedException</span> are delivered to the connection's exception listener via <span class="code_inline">onException</span>, indicating that messages in flight might be lost, depending on message delivery options. <span class="code_inline">ConnectionRestoredException</span> is delivered to indicate that the connection through to the JMS-compliant message broker has been re-established. <span class="code_inline">TemporaryTopic</span> and <span class="code_inline">TemporaryQueue</span> should be recreated at that time to resume operations.</li>
</ul>



                  </section>
                </article>

            </div> <!-- #main -->
        </div> <!-- #main-container -->

	<footer id="footer">

		<div class="container">

			<div class="row"><div class="span3"><div id="nav_menu-2" class="widget widget_nav_menu"><div class="menu-footer-firstnav-container"><ul id="menu-footer-firstnav" class="menu"><li id="menu-item-3533" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3533"><a href="http://www.kaazing.com/products/">Products</a>
<ul class="sub-menu">
	<li id="menu-item-3534" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3534"><a href="http://www.kaazing.com/products/kaazing-websocket-gateway/">Overview</a></li>
	<li id="menu-item-3535" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3535"><a href="http://www.kaazing.com/products/editions/">Product Editions</a></li>
	<li id="menu-item-3536" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3536"><a href="http://www.kaazing.com/products/benefits-and-roi/">Benefits &#038; ROI</a></li>
	<li id="menu-item-3537" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3537"><a href="http://www.kaazing.com/products/deployment-options/">Deployment Options</a></li>
	<li id="menu-item-3538" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3538"><a href="http://developer-stage.kaazing.com/product-demos/">Demos</a></li>
	<li id="menu-item-3539" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3539"><a href="http://www.kaazing.com/websocket/">WebSocket</a></li>
</ul>
</li>
<li id="menu-item-3540" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3540"><a href="http://www.kaazing.com/solutions/">Solutions</a>
<ul class="sub-menu">
	<li id="menu-item-3541" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3541"><a href="http://www.kaazing.com/solutions/real-time-trading-transactions/">Trading &#038; Transactions</a></li>
	<li id="menu-item-3542" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3542"><a href="http://www.kaazing.com/solutions/real-time-data-monitoring/">Data Monitoring</a></li>
	<li id="menu-item-3543" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3543"><a href="http://www.kaazing.com/solutions/real-time-collaboration/">Collaboration &#038; Chat</a></li>
	<li id="menu-item-3544" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3544"><a href="http://www.kaazing.com/solutions/enterprise-integration/">Enterprise Integration</a></li>
	<li id="menu-item-3545" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3545"><a href="http://www.kaazing.com/solutions/novpn-solutions/">NoVPN Solution</a></li>
	<li id="menu-item-3546" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3546"><a href="http://www.kaazing.com/solutions/mobile-notifications/">Mobile Notifications</a></li>
	<li id="menu-item-3547" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3547"><a href="http://www.kaazing.com/solutions/real-time-betting-bidding-voting/">Betting, Bidding &#038; Voting</a></li>
	<li id="menu-item-3548" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3548"><a href="http://www.kaazing.com/solutions/real-time-second-screen-connectivity/">Second Screen</a></li>
	<li id="menu-item-3549" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3549"><a href="http://www.kaazing.com/solutions/machine-to-machine/">Machine to Machine</a></li>
</ul>
</li>
<li id="menu-item-3550" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3550"><a href="http://www.kaazing.com/services/">Services</a>
<ul class="sub-menu">
	<li id="menu-item-3551" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3551"><a href="http://www.kaazing.com/services/kaazing-global-support/">Support</a></li>
	<li id="menu-item-3552" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3552"><a href="http://www.kaazing.com/services/consulting/">Consulting</a></li>
	<li id="menu-item-3553" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3553"><a href="http://www.kaazing.com/services/training/">Training</a></li>
</ul>
</li>
</ul></div></div></div><div class="span3"><div id="nav_menu-4" class="widget widget_nav_menu"><div class="menu-footer-secondnav-container"><ul id="menu-footer-secondnav" class="menu"><li id="menu-item-3443" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3443"><a href="http://www.kaazing.com/industries/">Industries</a>
<ul class="sub-menu">
	<li id="menu-item-3444" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3444"><a href="http://www.kaazing.com/industries/financial-services/">Financial Services</a></li>
	<li id="menu-item-3445" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3445"><a href="http://www.kaazing.com/industries/energy/">Energy &#038; Utilities</a></li>
	<li id="menu-item-3446" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3446"><a href="http://www.kaazing.com/industries/technology/">Technology</a></li>
	<li id="menu-item-3447" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3447"><a href="http://www.kaazing.com/industries/media-entertainment/">Media &#038; Entertainment</a></li>
	<li id="menu-item-3448" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3448"><a href="http://www.kaazing.com/industries/telecom/">Telecom</a></li>
	<li id="menu-item-3449" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3449"><a href="http://www.kaazing.com/industries/travel/">Travel &#038; Transportation</a></li>
	<li id="menu-item-3450" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3450"><a href="http://www.kaazing.com/industries/gambling-betting/">Gambling &#038; Betting</a></li>
	<li id="menu-item-3451" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3451"><a href="http://www.kaazing.com/industries/logistics/">Logistics &#038; Shipping</a></li>
	<li id="menu-item-3452" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3452"><a href="http://www.kaazing.com/industries/online-gaming/">Online Gaming</a></li>
	<li id="menu-item-3453" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3453"><a href="http://www.kaazing.com/industries/retail/">Retail</a></li>
	<li id="menu-item-3454" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3454"><a href="http://www.kaazing.com/industries/healthcare/">Healthcare</a></li>
</ul>
</li>
<li id="menu-item-3455" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3455"><a href="http://www.kaazing.com/about-us/customers/">Customers</a>
<ul class="sub-menu">
	<li id="menu-item-3456" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3456"><a href="http://www.kaazing.com/customers/testimonials/">Video Testimonials</a></li>
	<li id="menu-item-3457" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3457"><a href="http://www.kaazing.com/customers/customer-case-studies/">Customer Case Studies</a></li>
</ul>
</li>
<li id="menu-item-3458" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3458"><a href="http://www.kaazing.com/about-us/partners/">Partners</a></li>
</ul></div></div></div><div class="span3"><div id="nav_menu-6" class="widget widget_nav_menu"><div class="menu-footer-thirdnav-container"><ul id="menu-footer-thirdnav" class="menu"><li id="menu-item-3625" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3625"><a href="http://www.kaazing.com/about-us/">About Us</a>
<ul class="sub-menu">
	<li id="menu-item-3626" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3626"><a href="http://www.kaazing.com/about-us/">Overview</a></li>
	<li id="menu-item-3627" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3627"><a href="http://www.kaazing.com/about-us/press-releases-news/">Press Releases &#038; News</a></li>
	<li id="menu-item-3628" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3628"><a href="http://www.kaazing.com/events/">Events</a></li>
	<li id="menu-item-3629" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3629"><a href="http://www.kaazing.com/about-us/management/">Management Team</a></li>
	<li id="menu-item-3630" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3630"><a href="http://www.kaazing.com/about-us/board-of-directors/">Board of Directors</a></li>
	<li id="menu-item-3631" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3631"><a href="http://www.kaazing.com/about-us/advisory-board/">Advisory Board</a></li>
	<li id="menu-item-3632" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3632"><a href="http://www.kaazing.com/about-us/resource-center/">Resource Center</a></li>
	<li id="menu-item-3633" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3633"><a href="http://www.kaazing.com/about-us/careers/">Careers</a></li>
</ul>
</li>
<li id="menu-item-3634" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-1386 current_page_item menu-item-3634 active"><a href="http://developer.kaazing.com/">Developer</a>
<ul class="sub-menu">
	<li id="menu-item-3635" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3635"><a href="http://developer.kaazing.com/whykaazing/">Why Kaazing</a></li>
	<li id="menu-item-3636" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3636"><a href="http://developer.kaazing.com/downloads/">Downloads</a></li>
	<li id="menu-item-3637" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3637"><a href="http://developer.kaazing.com/how-tos/">How-tos</a></li>
	<li id="menu-item-3638" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3638"><a href="http://developer.kaazing.com/forums/">Forums</a></li>
	<li id="menu-item-3639" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3639"><a href="http://developer.kaazing.com/product-demos/">Product Demos</a></li>
	<li id="menu-item-3640" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3640"><a href="http://tech.kaazing.com/documentation/faq.html">Faq</a></li>
	<li id="menu-item-3641" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3641"><a href="http://tech.kaazing.com/documentation/index.html">Documentation</a></li>
</ul>
</li>
<li id="menu-item-3642" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3642"><a href="http://www.kaazing.com/cloud/">Cloud</a>
<ul class="sub-menu">
	<li id="menu-item-3643" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3643"><a href="http://www.kaazing.com/cloud/amis/">Aws AMIS</a></li>
	<li id="menu-item-3644" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3644"><a href="http://www.kaazing.com/cloud/faq/">Aws FAQS</a></li>
</ul>
</li>
</ul></div></div></div><div class="span3"><div id="text_contact-2" class="widget widget_text_contact"><h3 class="widgettitle title m_title">Get in Touch</h3>
			<div class="textwidget contact-details"><p>T +1 (877)&shy; Kaazing<br />

T +1 (877)&shy; 522-9464<br />

F +1 (650)&shy; 960-8145</p>



<p>Worldwide Headquarters<br />

Kaazing Corporation<br />

6001 America Center Drive<br />

Suite 250<br />

San Jose, CA 95002, USA</p>

</div>

		</div></div></div><!-- end row -->



			<div class="row">

				<div class="span12">

					<div class="bottom fixclear">



					<ul class="social-icons colored fixclear"><li class="title">connect &gt;</li><li class="social-twitter"><a href="http://twitter.com/kaazing" target="_blank">Twitter</a></li><li class="social-facebook"><a href="http://www.facebook.com/pages/Kaazing/143247694282" target="_blank">Facebook</a></li><li class="social-youtube"><a href="http://www.youtube.com/user/KaazingTV" target="_blank">Youtube</a></li></ul>



						<div class="copyright">





							<a href="http://www-stage.kaazing.com/"><img src="http://developer.kaazing.com/wordpress/wp-content/uploads/2013/06/Kaazing-footer_logo.png" alt="" /></a><p><div style="padding:10px 0;float:left; ">Copyright &copy; 2007-2015 Kaazing Corporation</div>

<div style="float:left;"><ul class="foot-menu"><li><a href="http://www.kaazing.com/legal/privacy/">Privacy Policy</a></li><li><a href="http://www.kaazing.com/legal/license/">Legal Information</a></li></ul></div></p>



						</div><!-- end copyright -->







					</div><!-- end bottom -->

				</div>

			</div><!-- end row -->



		</div>

	</footer>

</div><!-- end page_wrapper -->



    <a href="#" id="totop">TOP</a>


<script type='text/javascript' src='http://developer.kaazing.com/wordpress/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"\http:\/\/developer.kaazing.com/wordpress\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ..."};
/* ]]> */
</script>
<script type='text/javascript' src='http://developer.kaazing.com/wordpress/wp-content/plugins/contact-form-7/includes/js/scripts.js'></script>
<script type='text/javascript' src='http://developer.kaazing.com/wordpress/wp-content/themes/kallyas/addons/paralax/parallax.js'></script>
<script type='text/javascript' src='http://developer.kaazing.com/wordpress/wp-content/themes/kallyas/sliders/caroufredsel/jquery.carouFredSel-6.0.4-packed.js'></script>
<script type='text/javascript' src='http://developer.kaazing.com/wordpress/wp-content/themes/kallyas/js/bootstrap.min.js'></script>
<script type='text/javascript' src='http://developer.kaazing.com/wordpress/wp-content/themes/kallyas/js/plugins.js'></script>
<script type='text/javascript' src='http://developer.kaazing.com/wordpress/wp-content/themes/kallyas/addons/superfish_responsive/superfish_menu.js'></script>
<script type='text/javascript' src='http://developer.kaazing.com/wordpress/wp-content/themes/kallyas/addons/prettyphoto/jquery.prettyPhoto.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var zn_do_login = {"ajaxurl":"http:\/\/developer.kaazing.com\/wordpress\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='http://developer.kaazing.com/wordpress/wp-content/themes/kallyas/js/znscript.js'></script>
<script type="text/javascript">
								var parallax = new Parallax({
									container: '#slideshow',
									layers: [
										{ selector: '.para1', ratio: .020 },
										{ selector: '.para2', ratio: .010 },
										{ selector: '.para3', ratio: .008 },
										{ selector: '.para4', ratio: .005 },
										{ selector: '.para5', ratio: .005 }
									]
								});


						(function($){
							$(window).load(function(){
								var doc = $(document),
									win = $(window), chaser, forch,
									forchBottom, visible;
								function shown() { visible = true; }
								function hidden() { visible = false; }
								chaser = $('#main_menu ul.sf-menu').clone().hide()
									.appendTo(document.body)
									.wrap("<div class='chaser'><div class='container'><div class='row'><div class='span12'></div></div></div></div>");
								if ( $('#content').length > 0 ) {
									forch = $('#content').first();
									forchBottom = forch.offset().top + 2;
									hidden();
									win.on('scroll', function () {

										var top = doc.scrollTop();
										if (!visible && top > forchBottom) {
											//chaser.slideDown(300, shown);
											chaser.fadeIn(300, shown);
										} else if (visible && top < forchBottom) {
											//chaser.slideUp(200, hidden);
											chaser.fadeOut(200, hidden);
										}
									});
								}
								/* Activate Superfish Menu for Chaser */
								$('.chaser ul.sf-menu').supersubs({ minWidth: 12, maxWidth: 27, extraWidth: 1}).superfish({delay:250, dropShadows:false, autoArrows:true, speed:300});
							});
						})(jQuery);

						(function($){
							$(document).ready(function(){
								/* Activate Superfish Menu */
								var sfDelay = 600;
								if($('html').hasClass('isie'))
									sfDelay = 300;
								$('#main_menu > ul')
								.supersubs({
									minWidth:    12,   // minimum width of sub-menus in em units
									maxWidth:    27,   // maximum width of sub-menus in em units
									extraWidth:  1     // extra width can ensure lines don't sometimes turn over
								}).superfish({
									delay:sfDelay,
									dropShadows:false,
									autoArrows:true,
									speed:300
								});
								$('#top_menu > ul')
								.supersubs({
									minWidth:    12,   // minimum width of sub-menus in em units
									maxWidth:    27,   // maximum width of sub-menus in em units
									extraWidth:  1     // extra width can ensure lines don't sometimes turn over
								}).superfish({
									delay:sfDelay,
									dropShadows:false,
									autoArrows:true,
									speed:300
								});
							});


							$(window).resize(function() {
								$('#main_menu > ul')
								.supersubs({
									minWidth:    12,   // minimum width of sub-menus in em units
									maxWidth:    27,   // maximum width of sub-menus in em units
									extraWidth:  1     // extra width can ensure lines don't sometimes turn over
								});
								$('#top_menu > ul')
								.supersubs({
									minWidth:    12,   // minimum width of sub-menus in em units
									maxWidth:    27,   // maximum width of sub-menus in em units
									extraWidth:  1     // extra width can ensure lines don't sometimes turn over
								});
							});

						})(jQuery);
						</script>


		<script src="../../resources/js/jquery.details.js"></script>
        <script>
			$(function() {
				// Enable jquery.details
				//

				// Add conditional classname based on support
				$('html').addClass($.fn.details.support ? 'details' : 'no-details');

				// Emulate <details> where necessary and enable open/close event handlers
				$('details').details();

			});
        </script>

		<script type="text/javascript">
		    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
		    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		</script>

		<script type="text/javascript">
		    try {
		    var pageTracker = _gat._getTracker("UA-1771436-5");
		    pageTracker._trackPageview();
		    } catch(err) {}
		</script>

                        </body>


</html>
